<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VA Management System - Premium Dashboard</title>
    <!-- Build: 2025-10-24-SIDEBAR-REDESIGN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://upload-widget.cloudinary.com/global/all.js"></script>
    <style>
        /* ==================== EMBEDDED DESIGN TOKENS ==================== */
        :root {
          --color-bg-primary: #131313;
          --color-bg-secondary: #1a1a1a;
          --color-bg-tertiary: #222222;
          --color-bg-elevated: #2a2a2a;
          --color-text-primary: #ffffff;
          --color-text-secondary: #fafafae5;
          --color-text-tertiary: #fafafa99;
          --color-text-muted: #fafafa66;
          --color-border-subtle: rgba(255, 255, 255, 0.1);
          --color-border-medium: rgba(255, 255, 255, 0.15);
          --color-border-strong: rgba(255, 255, 255, 0.25);
          --color-hover-overlay: rgba(255, 255, 255, 0.05);
          --color-active-overlay: rgba(255, 255, 255, 0.1);
          --color-focus-ring: rgba(255, 255, 255, 0.4);
          --color-success-bg: rgba(255, 255, 255, 0.1);
          --color-success-text: #ffffff;
          --color-warning-bg: rgba(255, 255, 255, 0.08);
          --color-warning-text: #fafafae5;
          --color-danger-bg: rgba(255, 255, 255, 0.12);
          --color-danger-text: #ffffff;
          --color-btn-primary-bg: #ffffff;
          --color-btn-primary-text: #131313;
          --color-btn-secondary-bg: transparent;
          --color-btn-secondary-text: #ffffff;
          --color-btn-secondary-border: rgba(255, 255, 255, 0.25);
          --font-heading: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
          --font-body: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
          --text-xs: 0.75rem;
          --text-sm: 0.875rem;
          --text-base: 1rem;
          --text-lg: 1.125rem;
          --text-xl: 1.25rem;
          --text-2xl: 1.5rem;
          --text-3xl: 1.875rem;
          --text-4xl: 2.25rem;
          --font-normal: 400;
          --font-medium: 500;
          --font-semibold: 600;
          --font-bold: 700;
          --space-1: 0.25rem;
          --space-2: 0.5rem;
          --space-3: 0.75rem;
          --space-4: 1rem;
          --space-5: 1.25rem;
          --space-6: 1.5rem;
          --space-8: 2rem;
          --space-10: 2.5rem;
          --space-12: 3rem;
          --space-16: 4rem;
          --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
          --shadow-base: 0 1px 3px 0 rgba(0, 0, 0, 0.4);
          --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4);
          --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
          --radius-sm: 0.25rem;
          --radius-base: 0.5rem;
          --radius-md: 0.75rem;
          --radius-lg: 1rem;
          --radius-full: 9999px;
          --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
          --transition-base: 200ms cubic-bezier(0.4, 0, 0.2, 1);
          --transition-slow: 300ms cubic-bezier(0.4, 0, 0.2, 1);
          --tracking-normal: 0;
          --leading-tight: 1.25;
        }

        /* Modern Clean Design System */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        * {
            font-family: var(--font-body);
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* ==================== MODERN ENHANCEMENTS ==================== */

        /* Animated Gradient Mesh Background */
        @keyframes gradientShift {
            0%, 100% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        @keyframes glow {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* Gradient Shader Background */
        .gradient-bg {
            position: fixed;
            top: 0;
            left: 280px;
            right: 0;
            height: 100%;
            background: linear-gradient(135deg,
                rgba(99, 102, 241, 0.05) 0%,
                rgba(168, 85, 247, 0.05) 25%,
                rgba(236, 72, 153, 0.05) 50%,
                rgba(251, 146, 60, 0.05) 75%,
                rgba(59, 130, 246, 0.05) 100%
            );
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            pointer-events: none;
            z-index: 0;
        }

        .gradient-bg::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 50%);
            animation: float 8s ease-in-out infinite;
        }

        .gradient-bg::after {
            content: '';
            position: absolute;
            bottom: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(168, 85, 247, 0.1) 0%, transparent 50%);
            animation: float 12s ease-in-out infinite reverse;
        }

        /* Glassmorphism Effect */
        .glass-card {
            background: rgba(26, 26, 26, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            position: relative;
            overflow: hidden;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .glass-card:hover::before {
            opacity: 1;
        }

        /* Enhanced Stat Cards with Gradients */
        .stat-card-modern {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 2rem;
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .stat-card-modern::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg at 50% 50%,
                rgba(99, 102, 241, 0.1) 0deg,
                rgba(168, 85, 247, 0.1) 120deg,
                rgba(236, 72, 153, 0.1) 240deg,
                rgba(99, 102, 241, 0.1) 360deg
            );
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.6s ease;
        }

        .stat-card-modern:hover::before {
            opacity: 1;
            animation: spin 3s linear infinite;
        }

        @keyframes spin {
            100% { transform: rotate(360deg); }
        }

        .stat-card-modern:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3),
                        0 0 40px rgba(99, 102, 241, 0.1);
        }

        /* Modern Button Styles */
        .btn-modern {
            position: relative;
            background: linear-gradient(135deg, rgba(99, 102, 241, 1) 0%, rgba(168, 85, 247, 1) 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        .btn-modern::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .btn-modern:hover::before {
            left: 100%;
        }

        .btn-modern:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.5);
        }

        .btn-modern:active {
            transform: translateY(0);
        }

        /* Hero Section */
        .hero-section {
            position: relative;
            padding: 4rem 0;
            margin-bottom: 3rem;
            overflow: hidden;
        }

        .hero-title {
            font-size: 3.5rem;
            font-weight: 400;
            background: linear-gradient(135deg, #fff 0%, rgba(255, 255, 255, 0.7) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
            animation: float 3s ease-in-out infinite;
        }

        .hero-subtitle {
            font-size: 1.25rem;
            color: rgba(255, 255, 255, 0.6);
            max-width: 600px;
        }

        /* Feature Cards */
        .feature-card {
            background: rgba(26, 26, 26, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 2rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            border-color: rgba(168, 85, 247, 0.5);
            box-shadow: 0 10px 40px rgba(168, 85, 247, 0.2);
        }

        .feature-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(168, 85, 247, 0.2) 100%);
            animation: glow 3s ease-in-out infinite;
        }

        /* Typography System */
        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-heading);
            font-weight: var(--font-normal);
            letter-spacing: var(--tracking-normal);
            line-height: var(--leading-tight);
            color: var(--color-text-primary);
        }

        h1 { font-size: var(--text-5xl); }
        h2 { font-size: var(--text-3xl); }
        h3 { font-size: var(--text-2xl); }

        body {
            background: var(--color-bg-primary);
            color: var(--color-text-secondary);
            min-height: 100vh;
        }

        /* Sidebar Navigation */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 280px;
            background: var(--color-bg-secondary);
            border-right: 1px solid var(--color-border-subtle);
            display: flex;
            flex-direction: column;
            z-index: 40;
            transition: transform var(--transition-base);
        }

        .sidebar-header {
            padding: var(--space-6);
            border-bottom: 1px solid var(--color-border-subtle);
        }

        .sidebar-nav {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-4);
        }

        .sidebar-footer {
            padding: var(--space-6);
            border-top: 1px solid var(--color-border-subtle);
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: var(--space-3) var(--space-4);
            margin-bottom: var(--space-2);
            border-radius: var(--radius-base);
            color: var(--color-text-tertiary);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            cursor: pointer;
            transition: all var(--transition-base);
            border: 1px solid transparent;
        }

        .nav-item:hover {
            background: var(--color-hover-overlay);
            color: var(--color-text-secondary);
        }

        .nav-item.active {
            background: var(--color-active-overlay);
            color: var(--color-text-primary);
            border-color: var(--color-border-medium);
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            margin-right: var(--space-3);
            flex-shrink: 0;
        }

        /* Main Content Area */
        .main-content {
            margin-left: 280px;
            min-height: 100vh;
        }

        .content-wrapper {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-8) var(--space-6);
        }

        /* Enhanced Stats Cards */
        .stat-card {
            background: var(--color-bg-secondary);
            border: 1px solid var(--color-border-subtle);
            box-shadow: var(--shadow-md);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            transition: all var(--transition-base);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            border-color: var(--color-border-medium);
            box-shadow: var(--shadow-lg);
        }

        .stat-value {
            font-size: var(--text-4xl);
            font-weight: var(--font-bold);
            color: var(--color-text-primary);
            margin-top: var(--space-2);
        }

        .stat-label {
            font-size: var(--text-xs);
            font-weight: var(--font-semibold);
            color: var(--color-text-muted);
            text-transform: uppercase;
            letter-spacing: var(--tracking-wide);
        }

        /* Quick Actions */
        .quick-action-card {
            background: var(--color-bg-secondary);
            border: 1px solid var(--color-border-subtle);
            border-radius: var(--radius-lg);
            padding: var(--space-8);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .quick-action-card:hover {
            background: var(--color-hover-overlay);
            border-color: var(--color-border-medium);
            transform: translateY(-2px);
        }

        /* Glass Effect */
        .glass {
            background: var(--color-bg-secondary);
            border: 1px solid var(--color-border-subtle);
            box-shadow: var(--shadow-base);
            border-radius: var(--radius-md);
            padding: var(--space-6);
        }

        /* Buttons */
        .btn-primary {
            background: var(--color-btn-primary-bg) !important;
            color: var(--color-btn-primary-text) !important;
            border: none;
            padding: var(--space-3) var(--space-6);
            border-radius: var(--radius-full);
            font-weight: var(--font-medium);
            font-size: var(--text-sm);
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--color-btn-secondary-bg);
            color: var(--color-btn-secondary-text);
            border: 1px solid var(--color-btn-secondary-border);
            padding: var(--space-3) var(--space-6);
            border-radius: var(--radius-full);
            font-weight: var(--font-medium);
            font-size: var(--text-sm);
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .btn-secondary:hover {
            border-color: var(--color-text-primary);
        }

        /* Form Inputs */
        input, select, textarea {
            background: linear-gradient(0deg, var(--color-bg-primary), var(--color-bg-tertiary));
            border: 1px solid var(--color-border-subtle);
            color: var(--color-text-primary);
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-base);
            font-size: var(--text-sm);
            transition: all var(--transition-base);
        }

        input::placeholder {
            color: var(--color-text-muted);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--color-text-primary);
            background: var(--color-bg-tertiary);
        }

        /* Status Badges */
        .badge {
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
            font-weight: var(--font-semibold);
            text-transform: uppercase;
            letter-spacing: var(--tracking-wide);
        }

        .badge-active {
            background: var(--color-success-bg);
            color: var(--color-success-text);
            border: 1px solid var(--color-border-medium);
        }

        .badge-inactive, .badge-pending {
            background: var(--color-warning-bg);
            color: var(--color-warning-text);
            border: 1px solid var(--color-border-subtle);
        }

        /* Modal Backdrop */
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: var(--space-5);
            right: var(--space-5);
            padding: var(--space-4) var(--space-6);
            border-radius: var(--radius-base);
            color: white;
            font-weight: var(--font-medium);
            z-index: 9999;
            animation: slideInRight 0.2s ease-out;
        }

        @keyframes slideInRight {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast-success {
            background: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .toast-error {
            background: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        .slide-up { animation: slideUp 0.3s ease-out; }
        .hover-lift { transition: transform var(--transition-base); }
        .hover-lift:hover { transform: translateY(-4px); }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Login Screen */
        .login-container {
            background: var(--color-bg-secondary);
            border: 1px solid var(--color-border-subtle);
            box-shadow: var(--shadow-md);
            border-radius: var(--radius-lg);
            padding: var(--space-12);
            max-width: 400px;
        }

        /* Upload Area */
        .upload-area {
            border: 2px dashed var(--color-border-medium);
            background: var(--color-bg-tertiary);
            transition: all var(--transition-base);
        }

        .upload-area:hover {
            border-color: var(--color-border-strong);
            background: var(--color-hover-overlay);
        }

        /* Recent Activity */
        .activity-item {
            padding: var(--space-4);
            border-bottom: 1px solid var(--color-border-subtle);
            transition: background var(--transition-fast);
        }

        .activity-item:hover {
            background: var(--color-hover-overlay);
        }

        .activity-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Animated Gradient Background -->
    <div class="gradient-bg"></div>

    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="login-container slide-up">
            <div class="text-center mb-8">
                <div class="inline-block p-4 rounded-lg border" style="border-color: var(--color-border-subtle); margin-bottom: var(--space-4);">
                    <svg class="w-12 h-12" style="color: var(--color-text-tertiary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                    </svg>
                </div>
                <h1 style="font-size: 30px; margin-bottom: var(--space-2);">VA Management</h1>
                <p style="color: var(--color-text-muted);">Premium Dashboard 2025</p>
            </div>

            <form id="loginForm" style="display: flex; flex-direction: column; gap: var(--space-5);">
                <div>
                    <label class="block text-sm font-semibold mb-2" style="color: var(--color-text-secondary);">Username</label>
                    <input type="text" id="username"
                           class="w-full px-4 py-3 border-2 rounded-xl transition-all"
                           placeholder="Enter your username" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2" style="color: var(--color-text-secondary);">Password</label>
                    <input type="password" id="password"
                           class="w-full px-4 py-3 border-2 rounded-xl transition-all"
                           placeholder="Enter your password" required>
                </div>
                <button type="submit"
                        class="w-full btn-primary py-3 rounded-xl font-semibold shadow-lg">
                    Sign In
                </button>
                <div id="loginError" class="text-red-600 text-sm text-center hidden"></div>
            </form>
        </div>
    </div>

    <!-- Main Dashboard with Sidebar -->
    <div id="dashboard" class="hidden">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="flex items-center" style="gap: var(--space-3);">
                    <div class="p-2 rounded-lg border" style="border-color: var(--color-border-subtle);">
                        <svg class="w-8 h-8" style="color: var(--color-text-tertiary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                    </div>
                    <div>
                        <h2 style="font-size: var(--text-lg); font-weight: var(--font-bold); color: var(--color-text-primary);">VA Management</h2>
                        <p style="font-size: var(--text-xs); color: var(--color-text-muted);">Premium Dashboard</p>
                    </div>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-item active" onclick="showTab('dashboard')" id="navDashboard">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                    </svg>
                    <span>Dashboard</span>
                </div>

                <div class="nav-item" onclick="showTab('vas')" id="navVas">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                    </svg>
                    <span>Virtual Assistants</span>
                </div>

                <div class="nav-item" onclick="showTab('creators')" id="navCreators">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    <span>Creators</span>
                </div>

                <div class="nav-item" onclick="showTab('payments')" id="navPayments">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
                    </svg>
                    <span>Payments</span>
                </div>

                <div class="nav-item" onclick="showTab('finances')" id="navFinances">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>Finances</span>
                </div>

                <div class="nav-item" onclick="showTab('phones')" id="navPhones">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                    </svg>
                    <span>Phones</span>
                </div>
                <div class="nav-item" onclick="showTab('archived')" id="navArchived">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path>
                    </svg>
                    <span>Archived</span>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="flex items-center justify-between" style="gap: var(--space-3);">
                    <div class="flex items-center" style="gap: var(--space-3);">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center" style="background: var(--color-bg-tertiary); border: 1px solid var(--color-border-subtle);">
                            <svg class="w-5 h-5" style="color: var(--color-text-secondary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </div>
                        <div>
                            <p style="font-size: var(--text-sm); font-weight: var(--font-medium); color: var(--color-text-primary);">Admin</p>
                            <p style="font-size: var(--text-xs); color: var(--color-text-muted);">System Manager</p>
                        </div>
                    </div>
                    <button onclick="logout()" class="p-2 rounded-lg transition-colors" style="color: var(--color-text-muted); hover:background: var(--color-hover-overlay);">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="content-wrapper">
                <!-- Dashboard Tab (Enhanced) -->
                <div id="dashboardTab" class="fade-in" style="position: relative; z-index: 1;">

                    <!-- Stats Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4" style="gap: var(--space-6); margin-bottom: var(--space-8);">
                        <div class="stat-card-modern glass-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="stat-label">Total VAs</p>
                                    <p id="totalVAs" class="stat-value">-</p>
                                </div>
                                <div class="feature-icon">
                                    <svg class="w-6 h-6" style="color: rgba(59, 130, 246, 1);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card-modern glass-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="stat-label">Active VAs</p>
                                    <p id="activeVAs" class="stat-value">-</p>
                                </div>
                                <div class="feature-icon">
                                    <svg class="w-6 h-6" style="color: rgba(99, 102, 241, 1);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card-modern glass-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="stat-label">Total Creators</p>
                                    <p id="totalCreators" class="stat-value">-</p>
                                </div>
                                <div class="feature-icon">
                                    <svg class="w-6 h-6" style="color: rgba(168, 85, 247, 1);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card-modern glass-card">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="stat-label">Monthly Payout</p>
                                    <p id="monthlyPayout" class="stat-value">$-</p>
                                </div>
                                <div class="feature-icon">
                                    <svg class="w-6 h-6" style="color: rgba(236, 72, 153, 1);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Creator-VA Assignments -->
                    <div style="margin-bottom: var(--space-8);">
                        <div class="flex items-center justify-between" style="margin-bottom: var(--space-6);">
                            <h2 style="font-size: var(--text-2xl); font-weight: var(--font-bold); color: var(--color-text-primary);">Creator Assignments</h2>
                            <div class="flex" style="gap: var(--space-3);">
                                <button onclick="showAddCreatorModal()" class="btn-modern" style="padding: 0.5rem 1rem; font-size: var(--text-sm);">
                                    + Add Creator
                                </button>
                                <button onclick="showAddVAModal()" class="btn-modern" style="padding: 0.5rem 1rem; font-size: var(--text-sm);">
                                    + Add VA
                                </button>
                            </div>
                        </div>
                        <div id="creatorAssignments" class="space-y-4">
                            <!-- Creator cards will be loaded here -->
                        </div>
                    </div>

                    <!-- Available VAs (Unassigned) -->
                    <div style="margin-bottom: var(--space-8);">
                        <h2 style="font-size: var(--text-xl); font-weight: var(--font-semibold); color: var(--color-text-secondary); margin-bottom: var(--space-4);">Available VAs</h2>
                        <div id="availableVAs" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4" style="gap: var(--space-4);">
                            <!-- Unassigned VA cards will be loaded here -->
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div>
                        <h3 style="margin-bottom: var(--space-4); font-size: var(--text-xl);">Recent Activity</h3>
                        <div class="glass" id="recentActivity">
                            <div class="activity-item">
                                <p style="color: var(--color-text-muted); font-size: var(--text-sm);">Activity feed will appear here...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VAs Tab -->
                <div id="vasTab" class="hidden fade-in">
                    <div class="flex justify-between items-center" style="margin-bottom: var(--space-6);">
                        <h2 style="background: linear-gradient(135deg, #fff 0%, rgba(255, 255, 255, 0.7) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Virtual Assistants</h2>
                        <button onclick="showAddVAModal()"
                                class="btn-modern flex items-center" style="gap: var(--space-2);">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            <span>Add VA</span>
                        </button>
                    </div>

                    <div id="vasList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3" style="gap: var(--space-6);">
                        <!-- VAs will be loaded here -->
                    </div>
                </div>

                <!-- Creators Tab -->
                <div id="creatorsTab" class="hidden fade-in">
                    <div class="flex justify-between items-center" style="margin-bottom: var(--space-6);">
                        <h2 style="background: linear-gradient(135deg, #fff 0%, rgba(255, 255, 255, 0.7) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Creators</h2>
                        <button onclick="showAddCreatorModal()"
                                class="btn-modern flex items-center" style="gap: var(--space-2);">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            <span>Add Creator</span>
                        </button>
                    </div>

                    <div id="creatorsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3" style="gap: var(--space-6);">
                        <!-- Creators will be loaded here -->
                    </div>
                </div>

                <!-- Payments Tab -->
                <div id="paymentsTab" class="hidden fade-in">
                    <div class="flex justify-between items-center" style="margin-bottom: var(--space-6);">
                        <h2 style="background: linear-gradient(135deg, #fff 0%, rgba(255, 255, 255, 0.7) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Payment Groups</h2>
                        <button onclick="showAddPaymentGroupModal()"
                                class="btn-modern flex items-center" style="gap: var(--space-2);">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            <span>Add Group</span>
                        </button>
                    </div>

                    <div id="paymentGroupsList" style="display: flex; flex-direction: column; gap: var(--space-6);">
                        <!-- Payment groups will be loaded here -->
                    </div>
                </div>

                <!-- Finances Tab -->
                <div id="financesTab" class="hidden fade-in">
                    <div class="flex justify-between items-center" style="margin-bottom: var(--space-6);">
                        <h2 style="background: linear-gradient(135deg, #fff 0%, rgba(255, 255, 255, 0.7) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Payment History</h2>
                        <button onclick="showRecordPaymentModal()"
                                class="btn-modern flex items-center" style="gap: var(--space-2);">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            <span>Record Payment</span>
                        </button>
                    </div>

                    <div class="glass" style="overflow: hidden; border-radius: var(--radius-lg);">
                        <table class="w-full">
                            <thead style="background: var(--color-bg-tertiary);">
                                <tr>
                                    <th class="px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider" style="color: var(--color-text-secondary);">Date</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider" style="color: var(--color-text-secondary);">VA Name</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider" style="color: var(--color-text-secondary);">Amount</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider" style="color: var(--color-text-secondary);">Type</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider" style="color: var(--color-text-secondary);">Status</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider" style="color: var(--color-text-secondary);">Notes</th>
                                    <th class="px-6 py-4 text-left text-xs font-semibold uppercase tracking-wider" style="color: var(--color-text-secondary);">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="paymentHistoryTable" style="border-top: 1px solid var(--color-border-subtle);">
                                <!-- Payment history will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Phones Tab -->
                <div id="phonesTab" class="hidden fade-in">
                    <div class="flex justify-between items-center" style="margin-bottom: var(--space-6);">
                        <h2 style="background: linear-gradient(135deg, #fff 0%, rgba(255, 255, 255, 0.7) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Phone Inventory</h2>
                        <button onclick="showAddPhoneModal()"
                                class="btn-modern flex items-center" style="gap: var(--space-2);">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            <span>Add Phone</span>
                        </button>
                    </div>

                    <div id="phonesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3" style="gap: var(--space-6);">
                        <!-- Phones will be loaded here -->
                    </div>
                </div>

                <!-- Archived VAs Tab -->
                <div id="archivedTab" class="hidden fade-in">
                    <div class="flex justify-between items-center" style="margin-bottom: var(--space-6);">
                        <h2 style="background: linear-gradient(135deg, #fff 0%, rgba(255, 255, 255, 0.7) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">🗄️ Archived VAs</h2>
                        <p class="text-sm" style="color: var(--color-text-muted);">VAs that have been offboarded</p>
                    </div>

                    <div id="archivedVAsList" class="space-y-4">
                        <!-- Archived VAs will be loaded here -->
                    </div>
                </div>
            </div>
        </main>
    </div>


    <!-- Add VA Modal -->
    <div id="addVAModal" class="hidden fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
        <div class="glass rounded-3xl max-w-2xl w-full p-8 slide-up max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">Add Virtual Assistant</h3>
                <button onclick="closeModal('addVAModal')" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="addVAForm" class="space-y-5">
                <!-- Required Fields Only -->
                <div class="bg-purple-500/10 border border-purple-500/30 rounded-xl p-4 mb-4">
                    <p class="text-sm text-purple-200 mb-3">✨ <strong>Quick Add:</strong> Just name + telegram to get started! Fill in the rest during onboarding.</p>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2">Full Name *</label>
                        <input type="text" name="full_name" required
                               class="w-full px-4 py-3 border-2 border-white/10 rounded-xl bg-gray-800/50 text-white"
                               placeholder="John Doe">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2">Telegram Handle *</label>
                        <input type="text" name="telegram_handle" required
                               class="w-full px-4 py-3 border-2 border-white/10 rounded-xl bg-gray-800/50 text-white"
                               placeholder="@johndoe">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-300 mb-2">Notes (e.g., "onboarding in progress")</label>
                    <textarea name="notes" rows="2"
                              class="w-full px-4 py-3 border-2 border-white/10 rounded-xl bg-gray-800/50 text-white"
                              placeholder="Add any notes about this VA's current status..."></textarea>
                </div>

                <!-- Optional Details - Collapsed by Default -->
                <div class="border-t border-white/10 pt-4">
                    <button type="button" onclick="document.getElementById('optionalVAFields').classList.toggle('hidden')"
                            class="flex items-center space-x-2 text-gray-400 hover:text-white transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                        <span class="text-sm font-medium">Optional Details (can add later)</span>
                    </button>
                </div>

                <div id="optionalVAFields" class="hidden space-y-4 border-t border-white/10 pt-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-300 mb-2">VA Type</label>
                            <select name="va_type" id="vaType" onchange="toggleCustomSalary()"
                                    class="w-full px-4 py-3 border-2 border-white/10 rounded-xl bg-gray-800/50 text-white">
                                <option value="social_media">Social Media VA</option>
                                <option value="editor">Editor</option>
                                <option value="manager">Manager</option>
                                <option value="specialist">Specialist</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-300 mb-2">Onboarding Date</label>
                            <input type="date" name="onboarding_date" id="vaOnboardingDate"
                                   class="w-full px-4 py-3 border-2 border-white/10 rounded-xl bg-gray-800/50 text-white">
                        </div>
                    </div>

                <div class="grid grid-cols-2 gap-4">
                    <div id="baseSalaryField">
                        <label class="block text-sm font-semibold text-gray-300 mb-2">Base Salary ($)</label>
                        <input type="number" name="monthly_base_salary" step="0.01" value="500"
                               class="w-full px-4 py-3 border-2 border-white/10 rounded-xl bg-gray-800/50 text-white">
                        <p class="text-xs text-gray-400 mt-1">For Social Media VAs: Starting salary (3-stage progression)</p>
                    </div>
                    <div id="customSalaryField" class="hidden">
                        <label class="block text-sm font-semibold text-gray-300 mb-2">Fixed Monthly Salary ($) *</label>
                        <input type="number" name="custom_salary" id="vaCustomSalary" step="0.01"
                               class="w-full px-4 py-3 border-2 border-white/10 rounded-xl bg-gray-800/50 text-white"
                               placeholder="500">
                        <p class="text-xs text-gray-400 mt-1">Fixed salary (no progression stages)</p>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2">Payment Group</label>
                        <select name="payment_group_id" id="vaPaymentGroup"
                                class="w-full px-4 py-3 border-2 border-white/10 rounded-xl bg-gray-800/50 text-white">
                            <option value="">No Group</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2">Status</label>
                        <select name="status"
                                class="w-full px-4 py-3 border-2 border-white/10 rounded-xl bg-gray-800/50 text-white">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-300 mb-2">Assign Creators (Optional)</label>
                    <div id="creatorCheckboxes" class="space-y-2 max-h-48 overflow-y-auto bg-gray-800/30 border border-white/10 rounded-xl p-4">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Profile Photo</label>
                    <div id="uploadWidget" class="upload-area rounded-xl p-8 text-center cursor-pointer">
                        <svg class="w-12 h-12 mx-auto text-gray-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <p class="text-gray-600">Click to upload photo</p>
                        <p class="text-sm text-gray-400 mt-1">PNG, JPG up to 10MB</p>
                    </div>
                    <input type="hidden" name="profile_photo_url" id="profilePhotoUrl">
                    <div id="photoPreview" class="hidden mt-4">
                        <img id="photoPreviewImg" class="w-32 h-32 rounded-xl object-cover mx-auto">
                    </div>
                </div>

                <!-- Phone Setup Checklist Section -->
                <div class="border-t border-white/10 pt-6 mt-6">
                    <h4 class="text-lg font-semibold text-white mb-4">Phone Setup Checklist</h4>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-300 mb-2">Phone Assignment</label>
                            <select name="phone_type" id="phoneType" onchange="togglePhoneTransfer()"
                                    class="w-full px-4 py-3 border-2 border-white/10 rounded-xl bg-gray-800/50 text-white">
                                <option value="">No phone yet (will assign later)</option>
                                <option value="new">New Phone</option>
                                <option value="transfer">Transfer from Existing VA</option>
                            </select>
                            <p class="text-xs text-gray-400 mt-1">You can assign a phone later when offboarding another VA</p>
                        </div>

                        <div id="phoneTransferField" class="hidden">
                            <label class="block text-sm font-semibold text-gray-300 mb-2">Transfer Phone From *</label>
                            <select name="phone_from_va_id" id="phoneFromVA"
                                    class="w-full px-4 py-3 border-2 border-white/10 rounded-xl bg-gray-800/50 text-white">
                                <option value="">Select VA</option>
                            </select>
                        </div>

                        <div class="space-y-3">
                            <label class="flex items-center space-x-3 cursor-pointer">
                                <input type="checkbox" name="apple_code_provided" id="appleCodeProvided"
                                       class="w-5 h-5 rounded border-white/20 bg-gray-800/50 text-blue-500">
                                <span class="text-sm text-gray-300">Apple Code Provided</span>
                            </label>

                            <label class="flex items-center space-x-3 cursor-pointer">
                                <input type="checkbox" name="proxy_configured" id="proxyConfigured"
                                       class="w-5 h-5 rounded border-white/20 bg-gray-800/50 text-blue-500">
                                <span class="text-sm text-gray-300">Proxy Configured</span>
                            </label>

                            <label class="flex items-center space-x-3 cursor-pointer">
                                <input type="checkbox" name="training_materials_provided" id="trainingMaterialsProvided"
                                       class="w-5 h-5 rounded border-white/20 bg-gray-800/50 text-blue-500">
                                <span class="text-sm text-gray-300">Training Materials Provided</span>
                                <span class="text-xs text-gray-500">(Coming soon)</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeModal('addVAModal')"
                            class="px-6 py-3 border-2 border-gray-200 rounded-xl font-semibold text-gray-600 hover:bg-gray-50">
                        Cancel
                    </button>
                    <button type="submit"
                            class="btn-primary px-6 py-3 text-white rounded-xl font-semibold">
                        Add VA
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit VA Modal -->
    <div id="editVAModal" class="hidden fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
        <div class="glass rounded-3xl max-w-lg w-full p-8 slide-up">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">Edit VA</h3>
                <button onclick="closeModal('editVAModal')" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="editVAForm" class="space-y-5">
                <input type="hidden" id="editVAId">

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Full Name *</label>
                        <input type="text" id="editFullName" required
                               class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                               placeholder="John Doe">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Telegram Handle *</label>
                        <input type="text" id="editTelegramHandle" required
                               class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                               placeholder="@johndoe">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2">VA Type *</label>
                        <select id="editVAType" onchange="toggleEditCustomSalary()"
                                class="w-full px-4 py-3 border-2 border-white/10 rounded-xl bg-gray-800/50 text-white">
                            <option value="social_media">Social Media VA</option>
                            <option value="editor">Editor</option>
                            <option value="manager">Manager</option>
                            <option value="specialist">Specialist</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2">Joined Date</label>
                        <input type="date" id="editOnboardingDate"
                               class="w-full px-4 py-3 border-2 border-white/10 rounded-xl bg-gray-800/50 text-white">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div id="editBaseSalaryField">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Base Salary ($)</label>
                        <input type="number" id="editMonthlySalary" step="0.01"
                               class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl">
                        <p class="text-xs text-gray-400 mt-1">For Social Media VAs: Starting salary (3-stage progression)</p>
                    </div>
                    <div id="editCustomSalaryField" class="hidden">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Fixed Monthly Salary ($) *</label>
                        <input type="number" id="editCustomSalary" step="0.01"
                               class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                               placeholder="500">
                        <p class="text-xs text-gray-400 mt-1">Fixed salary (no progression stages)</p>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Payment Group</label>
                        <select id="editPaymentGroup"
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl">
                            <option value="">No Group</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Status</label>
                        <select id="editStatus"
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Assigned Creators</label>
                        <select id="editAssignedCreators" multiple
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                                style="min-height: 100px;">
                            <!-- Populated dynamically -->
                        </select>
                        <p class="text-xs text-gray-500 mt-1">Hold Ctrl/Cmd to select multiple</p>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Profile Photo</label>
                    <div id="editUploadWidget" class="upload-area rounded-xl p-8 text-center cursor-pointer">
                        <svg class="w-12 h-12 mx-auto text-gray-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <p class="text-gray-600">Click to upload new photo</p>
                        <p class="text-sm text-gray-400 mt-1">PNG, JPG up to 10MB</p>
                    </div>
                    <input type="hidden" id="editProfilePhotoUrl">
                    <div id="editPhotoPreview" class="hidden mt-4">
                        <img id="editPhotoPreviewImg" class="w-32 h-32 rounded-xl object-cover mx-auto">
                    </div>
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeModal('editVAModal')"
                            class="px-6 py-3 border-2 border-gray-200 rounded-xl font-semibold text-gray-600 hover:bg-gray-50">
                        Cancel
                    </button>
                    <button type="submit"
                            class="btn-primary px-6 py-3 text-white rounded-xl font-semibold">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Payment Group Modal -->
    <div id="addPaymentGroupModal" class="hidden fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
        <div class="glass rounded-3xl max-w-lg w-full p-8 slide-up">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">Add Payment Group</h3>
                <button onclick="closeModal('addPaymentGroupModal')" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="addPaymentGroupForm" class="space-y-5">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Group Name *</label>
                    <input type="text" name="group_name" required
                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                           placeholder="Family A">
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Leader Name *</label>
                    <input type="text" name="leader_name" required
                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                           placeholder="John Doe">
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Wallet Address *</label>
                    <input type="text" name="wallet_address" required
                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                           placeholder="0x...">
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeModal('addPaymentGroupModal')"
                            class="px-6 py-3 border-2 border-gray-200 rounded-xl font-semibold text-gray-600 hover:bg-gray-50">
                        Cancel
                    </button>
                    <button type="submit"
                            class="btn-primary px-6 py-3 text-white rounded-xl font-semibold">
                        Add Group
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Phone Modal -->
    <div id="addPhoneModal" class="hidden fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
        <div class="glass rounded-3xl max-w-lg w-full p-8 slide-up">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">Add Phone</h3>
                <button onclick="closeModal('addPhoneModal')" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="addPhoneForm" class="space-y-5">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Apple ID Email *</label>
                    <input type="email" name="apple_id_email" required
                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                           placeholder="appleid@example.com">
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Apple ID Password *</label>
                    <input type="password" name="apple_id_password" required
                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                           placeholder="••••••••">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Proxy IP *</label>
                        <input type="text" name="proxy_ip" required
                               class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                               placeholder="192.168.1.1">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Proxy Port *</label>
                        <input type="number" name="proxy_port" required
                               class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                               placeholder="8080">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Proxy Username</label>
                    <input type="text" name="proxy_username"
                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                           placeholder="Optional">
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Proxy Password</label>
                    <input type="password" name="proxy_password"
                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                           placeholder="Optional">
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeModal('addPhoneModal')"
                            class="px-6 py-3 border-2 border-gray-200 rounded-xl font-semibold text-gray-600 hover:bg-gray-50">
                        Cancel
                    </button>
                    <button type="submit"
                            class="btn-primary px-6 py-3 text-white rounded-xl font-semibold">
                        Add Phone
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Creator Modal -->
    <div id="addCreatorModal" class="hidden fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
        <div class="glass rounded-3xl max-w-lg w-full p-8 slide-up">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">Add Creator</h3>
                <button onclick="closeModal('addCreatorModal')" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="addCreatorForm" class="space-y-5">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Creator Name *</label>
                    <input type="text" name="creator_name" required
                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                           placeholder="TikTok Creator Name">
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Monthly Cost ($)</label>
                    <input type="number" name="monthly_cost" step="0.01" value="0"
                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl">
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Profile Photo</label>
                    <div id="addCreatorUploadWidget" class="upload-area rounded-xl p-8 text-center cursor-pointer">
                        <svg class="w-12 h-12 mx-auto text-gray-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <p class="text-gray-600">Click to upload photo</p>
                        <p class="text-sm text-gray-400 mt-1">PNG, JPG up to 10MB</p>
                    </div>
                    <input type="hidden" name="profile_photo_url" id="addCreatorProfilePhotoUrl">
                    <div id="addCreatorPhotoPreview" class="hidden mt-4">
                        <img id="addCreatorPhotoPreviewImg" class="w-32 h-32 rounded-xl object-cover mx-auto">
                    </div>
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeModal('addCreatorModal')"
                            class="px-6 py-3 border-2 border-gray-200 rounded-xl font-semibold text-gray-600 hover:bg-gray-50">
                        Cancel
                    </button>
                    <button type="submit"
                            class="btn-primary px-6 py-3 text-white rounded-xl font-semibold">
                        Add Creator
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Payment Group Details Modal -->
    <div id="groupDetailsModal" class="hidden fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
        <div class="glass rounded-3xl max-w-4xl w-full p-8 slide-up max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">Payment Group Details</h3>
                <button onclick="closeModal('groupDetailsModal')" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div id="groupDetailsContent" class="space-y-6">
                <!-- Content will be loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Record Payment Modal -->
    <div id="recordPaymentModal" class="hidden fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
        <div class="glass rounded-3xl max-w-lg w-full p-8 slide-up">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">Record Payment</h3>
                <button onclick="closeModal('recordPaymentModal')" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="recordPaymentForm" class="space-y-5">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">VA *</label>
                    <select name="va_id" id="paymentVASelect" required
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl">
                        <option value="">Select VA</option>
                    </select>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Amount ($) *</label>
                        <input type="number" name="amount" step="0.01" required
                               class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                               placeholder="500.00">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Payment Date *</label>
                        <input type="date" name="payment_date" required
                               class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Type *</label>
                        <select name="payment_type" required
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl">
                            <option value="salary">Salary</option>
                            <option value="bonus">Bonus</option>
                            <option value="reimbursement">Reimbursement</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Status *</label>
                        <select name="status" required
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl">
                            <option value="pending">Pending</option>
                            <option value="completed">Completed</option>
                            <option value="failed">Failed</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Notes</label>
                    <textarea name="notes" rows="3"
                              class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                              placeholder="Optional payment notes..."></textarea>
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeModal('recordPaymentModal')"
                            class="px-6 py-3 border-2 border-gray-200 rounded-xl font-semibold text-gray-600 hover:bg-gray-50">
                        Cancel
                    </button>
                    <button type="submit"
                            class="btn-primary px-6 py-3 text-white rounded-xl font-semibold">
                        Record Payment
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Phone Modal -->
    <div id="editPhoneModal" class="hidden fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
        <div class="glass rounded-3xl max-w-lg w-full p-8 slide-up">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">Edit Phone</h3>
                <button onclick="closeModal('editPhoneModal')" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="editPhoneForm" class="space-y-5">
                <input type="hidden" id="editPhoneId">

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Apple ID Email *</label>
                    <input type="email" id="editPhoneAppleId" required
                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                           placeholder="appleid@example.com">
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Apple ID Password *</label>
                    <input type="password" id="editPhonePassword" required
                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                           placeholder="••••••••">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Proxy IP *</label>
                        <input type="text" id="editPhoneProxyIp" required
                               class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                               placeholder="192.168.1.1">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Proxy Port *</label>
                        <input type="number" id="editPhoneProxyPort" required
                               class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                               placeholder="8080">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Proxy Username</label>
                    <input type="text" id="editPhoneProxyUsername"
                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                           placeholder="Optional">
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Proxy Password</label>
                    <input type="password" id="editPhoneProxyPassword"
                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                           placeholder="Optional">
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Assign to VA</label>
                    <select id="editPhoneVASelect"
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl">
                        <option value="">Unassigned</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Status</label>
                    <select id="editPhoneStatus"
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl">
                        <option value="available">Available</option>
                        <option value="in_use">In Use</option>
                        <option value="maintenance">Maintenance</option>
                    </select>
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeModal('editPhoneModal')"
                            class="px-6 py-3 border-2 border-gray-200 rounded-xl font-semibold text-gray-600 hover:bg-gray-50">
                        Cancel
                    </button>
                    <button type="submit"
                            class="btn-primary px-6 py-3 text-white rounded-xl font-semibold">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Creator Modal -->
    <div id="editCreatorModal" class="hidden fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
        <div class="glass rounded-3xl max-w-lg w-full p-8 slide-up max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">Edit Creator</h3>
                <button onclick="closeModal('editCreatorModal')" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <form id="editCreatorForm" class="space-y-5">
                <input type="hidden" id="editCreatorId">

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Creator Name *</label>
                    <input type="text" id="editCreatorName" required
                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                           placeholder="TikTok Creator Name">
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Monthly Cost ($)</label>
                    <input type="number" id="editCreatorMonthlyCost" step="0.01"
                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                           placeholder="0.00">
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Notes</label>
                    <textarea id="editCreatorNotes" rows="3"
                              class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl"
                              placeholder="Optional notes about this creator..."></textarea>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Profile Photo</label>
                    <div id="editCreatorUploadWidget" class="upload-area rounded-xl p-8 text-center cursor-pointer">
                        <svg class="w-12 h-12 mx-auto text-gray-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <p class="text-gray-600">Click to upload new photo</p>
                        <p class="text-sm text-gray-400 mt-1">PNG, JPG up to 10MB</p>
                    </div>
                    <input type="hidden" id="editCreatorPhotoUrl">
                    <div id="editCreatorPhotoPreview" class="hidden mt-4">
                        <img id="editCreatorPhotoPreviewImg" class="w-32 h-32 rounded-xl object-cover mx-auto">
                    </div>
                </div>

                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeModal('editCreatorModal')"
                            class="px-6 py-3 border-2 border-gray-200 rounded-xl font-semibold text-gray-600 hover:bg-gray-50">
                        Cancel
                    </button>
                    <button type="submit"
                            class="btn-primary px-6 py-3 text-white rounded-xl font-semibold">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Offboard VA Modal -->
    <div id="offboardVAModal" class="hidden fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
        <div class="glass rounded-3xl max-w-2xl w-full p-8 slide-up max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">Offboard VA</h3>
                <button onclick="closeModal('offboardVAModal')" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-xl p-4 mb-6">
                <p class="text-yellow-200 text-sm">
                    <strong>Note:</strong> Offboarding will archive this VA. Their data will be preserved but they will no longer appear in active lists.
                </p>
            </div>

            <form id="offboardVAForm" class="space-y-6">
                <input type="hidden" id="offboardVAId">
                <input type="hidden" id="offboardVAName">

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2">Offboarding Reason *</label>
                        <select name="reason" id="offboardReason" required
                                class="w-full px-4 py-3 border-2 border-white/10 rounded-xl bg-gray-800/50 text-white">
                            <option value="">Select reason</option>
                            <option value="performance">Performance Issues</option>
                            <option value="resignation">Resignation</option>
                            <option value="contract_end">Contract End</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-300 mb-2">Final Payment ($)</label>
                        <input type="number" name="final_payment" id="offboardFinalPayment" step="0.01"
                               class="w-full px-4 py-3 border-2 border-white/10 rounded-xl bg-gray-800/50 text-white"
                               placeholder="0.00">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-300 mb-2">Reason Details</label>
                    <textarea name="reason_details" id="offboardReasonDetails" rows="3"
                              class="w-full px-4 py-3 border-2 border-white/10 rounded-xl bg-gray-800/50 text-white"
                              placeholder="Provide more details about the offboarding reason..."></textarea>
                </div>

                <!-- Phone Management Section -->
                <div class="border-t border-white/10 pt-6 mt-6">
                    <h4 class="text-lg font-semibold text-white mb-4">Phone Management</h4>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-300 mb-2">What should happen to the phone?</label>
                            <select id="offboardPhoneAction" onchange="toggleOffboardPhoneTransfer()"
                                    class="w-full px-4 py-3 border-2 border-white/10 rounded-xl bg-gray-800/50 text-white">
                                <option value="">Select option</option>
                                <option value="transfer">Transfer to Another VA</option>
                                <option value="inventory">Return to Inventory</option>
                            </select>
                        </div>

                        <div id="offboardPhoneTransferField" class="hidden">
                            <label class="block text-sm font-semibold text-gray-300 mb-2">Transfer Phone To *</label>
                            <select name="phone_transferred_to_va_id" id="offboardPhoneTransferTo"
                                    class="w-full px-4 py-3 border-2 border-white/10 rounded-xl bg-gray-800/50 text-white">
                                <option value="">Select VA</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-300 mb-2">Additional Notes</label>
                    <textarea name="notes" id="offboardNotes" rows="3"
                              class="w-full px-4 py-3 border-2 border-white/10 rounded-xl bg-gray-800/50 text-white"
                              placeholder="Any additional notes about this offboarding..."></textarea>
                </div>

                <div class="flex justify-end space-x-3 pt-4 border-t border-white/10">
                    <button type="button" onclick="closeModal('offboardVAModal')"
                            class="px-6 py-3 border-2 border-gray-200 rounded-xl font-semibold text-gray-300 hover:bg-white/5">
                        Cancel
                    </button>
                    <button type="submit"
                            class="px-6 py-3 bg-red-500 hover:bg-red-600 text-white rounded-xl font-semibold">
                        Offboard VA
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="glass rounded-2xl p-8">
            <div class="spinner mx-auto mb-4"></div>
            <p class="text-gray-700 font-semibold">Loading...</p>
        </div>
    </div>

    
    <script>
        const API_URL = 'https://va-management-backend-production.up.railway.app/api';
        let token = localStorage.getItem('token');
        let cloudinaryWidget;
        let editCloudinaryWidget;
        let addCreatorCloudinaryWidget;

        // Payment Stages Configuration
        // Month 1: $150, Month 2: $200, Month 3+: $300 (final)
        const PAYMENT_STAGES = [
            { month: 1, salary: 150 },
            { month: 2, salary: 200 },
            { month: 3, salary: 300 }  // Final stage - no more raises
        ];

        // Calculate which month of work this is (1st month, 2nd month, etc.)
        function calculateWorkMonth(onboardingDate) {
            if (!onboardingDate) return 0;

            const start = new Date(onboardingDate);
            const now = new Date();

            // Calculate full months between start and now
            const yearDiff = now.getFullYear() - start.getFullYear();
            const monthDiff = now.getMonth() - start.getMonth();
            const workMonth = (yearDiff * 12) + monthDiff + 1; // +1 because first month is month 1

            return Math.max(1, workMonth);
        }

        // Calculate pro-rated salary for partial month
        function calculateProRatedSalary(onboardingDate, baseSalary) {
            const start = new Date(onboardingDate);
            const startDay = start.getDate();

            // If they started on the 1st, no pro-rating needed
            if (startDay === 1) return baseSalary;

            // Calculate days worked in the first month
            const daysInMonth = new Date(start.getFullYear(), start.getMonth() + 1, 0).getDate();
            const daysWorked = daysInMonth - startDay + 1; // +1 to include start day

            // Pro-rate: (salary / 30) * days_worked
            return Math.round((baseSalary / 30) * daysWorked * 100) / 100; // Round to 2 decimals
        }

        // Check if VA is in their first month
        function isFirstMonth(onboardingDate) {
            if (!onboardingDate) return false;

            const start = new Date(onboardingDate);
            const now = new Date();

            return start.getMonth() === now.getMonth() && start.getFullYear() === now.getFullYear();
        }

        // Get current payment stage based on work month
        function getPaymentStage(onboardingDate) {
            if (!onboardingDate) return null;

            const workMonth = calculateWorkMonth(onboardingDate);

            // Determine current stage (max out at month 3)
            const stageIndex = Math.min(workMonth - 1, PAYMENT_STAGES.length - 1);
            const currentStage = PAYMENT_STAGES[stageIndex];

            // Determine next stage (null if already at max)
            const nextStage = workMonth < PAYMENT_STAGES.length ? PAYMENT_STAGES[workMonth] : null;

            // Calculate actual salary (pro-rated if first month and mid-month start)
            let actualSalary = currentStage.salary;
            if (isFirstMonth(onboardingDate)) {
                actualSalary = calculateProRatedSalary(onboardingDate, currentStage.salary);
            }

            return {
                workMonth,
                currentStage: workMonth,
                currentSalary: currentStage.salary,
                actualSalary: actualSalary,
                isProRated: isFirstMonth(onboardingDate) && actualSalary !== currentStage.salary,
                nextStage: nextStage?.month || null,
                nextSalary: nextStage?.salary || null,
                isMaxLevel: workMonth >= PAYMENT_STAGES.length
            };
        }

        // Toggle custom salary field in Add VA modal
        function toggleCustomSalary() {
            const vaType = document.getElementById('vaType').value;
            const baseSalaryField = document.getElementById('baseSalaryField');
            const customSalaryField = document.getElementById('customSalaryField');

            if (vaType === 'social_media') {
                baseSalaryField.classList.remove('hidden');
                customSalaryField.classList.add('hidden');
                document.getElementById('vaCustomSalary').removeAttribute('required');
            } else {
                baseSalaryField.classList.add('hidden');
                customSalaryField.classList.remove('hidden');
                document.getElementById('vaCustomSalary').setAttribute('required', 'required');
            }
        }

        // Toggle custom salary field in Edit VA modal
        function toggleEditCustomSalary() {
            const vaType = document.getElementById('editVAType').value;
            const baseSalaryField = document.getElementById('editBaseSalaryField');
            const customSalaryField = document.getElementById('editCustomSalaryField');

            if (vaType === 'social_media') {
                baseSalaryField.classList.remove('hidden');
                customSalaryField.classList.add('hidden');
                document.getElementById('editCustomSalary').removeAttribute('required');
            } else {
                baseSalaryField.classList.add('hidden');
                customSalaryField.classList.remove('hidden');
                document.getElementById('editCustomSalary').setAttribute('required', 'required');
            }
        }

        // Toggle phone transfer field visibility
        function togglePhoneTransfer() {
            const phoneType = document.getElementById('phoneType').value;
            const phoneTransferField = document.getElementById('phoneTransferField');
            const phoneFromVA = document.getElementById('phoneFromVA');

            if (phoneType === 'transfer') {
                phoneTransferField.classList.remove('hidden');
                phoneFromVA.setAttribute('required', 'required');
            } else {
                phoneTransferField.classList.add('hidden');
                phoneFromVA.removeAttribute('required');
                phoneFromVA.value = '';
            }
        }

        // Load active VAs for phone transfer dropdown
        async function loadActiveVAsForTransfer() {
            try {
                const response = await fetch(`${API_URL}/vas?status=active`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) throw new Error('Failed to load VAs');

                const vas = await response.json();
                const select = document.getElementById('phoneFromVA');

                // Clear existing options except the first one
                select.innerHTML = '<option value="">Select VA</option>';

                // Add all active VAs
                vas.forEach(va => {
                    const option = document.createElement('option');
                    option.value = va.id;
                    option.textContent = `${va.full_name} (@${va.telegram_handle})`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading VAs for transfer:', error);
                showToast('Failed to load VAs for phone transfer', 'error');
            }
        }

        // Toggle offboarding phone transfer field visibility
        function toggleOffboardPhoneTransfer() {
            const phoneAction = document.getElementById('offboardPhoneAction').value;
            const phoneTransferField = document.getElementById('offboardPhoneTransferField');
            const phoneTransferTo = document.getElementById('offboardPhoneTransferTo');

            if (phoneAction === 'transfer') {
                phoneTransferField.classList.remove('hidden');
                phoneTransferTo.setAttribute('required', 'required');
            } else {
                phoneTransferField.classList.add('hidden');
                phoneTransferTo.removeAttribute('required');
                phoneTransferTo.value = '';
            }
        }

        // Show offboarding modal
        async function showOffboardVAModal(vaId, vaName) {
            document.getElementById('offboardVAId').value = vaId;
            document.getElementById('offboardVAName').value = vaName;

            // Load active VAs for phone transfer dropdown (excluding the VA being offboarded)
            try {
                const response = await fetch(`${API_URL}/vas?status=active`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) throw new Error('Failed to load VAs');

                const vas = await response.json();
                const select = document.getElementById('offboardPhoneTransferTo');

                select.innerHTML = '<option value="">Select VA</option>';

                // Add all active VAs except the one being offboarded
                vas.filter(va => va.id !== parseInt(vaId)).forEach(va => {
                    const option = document.createElement('option');
                    option.value = va.id;
                    option.textContent = `${va.full_name} (@${va.telegram_handle})`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading VAs for transfer:', error);
                showToast('Failed to load VAs for phone transfer', 'error');
            }

            document.getElementById('offboardVAModal').classList.remove('hidden');
        }

        // Generate phone setup message templates
        function generatePhoneSetupMessage(vaName, phoneType, transferFromVA = null) {
            const messages = {
                new: `NEW PHONE SETUP NEEDED

VA: ${vaName}
Phone: Brand new device

Tasks:
1. ✅ Download required apps (TikTok, etc.)
2. ✅ Setup Apple Code for app downloads
3. ✅ Configure proxy (use standard setup)
4. ✅ Test all apps are working
5. ✅ Confirm setup complete

Please confirm when done!`,

                transfer: `PHONE TRANSFER NEEDED

Transfer FROM: ${transferFromVA}
Transfer TO: ${vaName}

Tasks:
1. ✅ Collect phone from ${transferFromVA}
2. ✅ Wipe/reset if needed
3. ✅ Update Apple Code if necessary
4. ✅ Verify proxy is still configured
5. ✅ Give phone to ${vaName}
6. ✅ Test all apps are working

Please confirm when done!`
            };

            return messages[phoneType] || '';
        }

        function generateOffboardingMessage(vaName, phoneAction, transferToVA = null) {
            if (phoneAction === 'transfer' && transferToVA) {
                return `PHONE TRANSFER NEEDED (Offboarding)

${vaName} is being offboarded.

Transfer phone TO: ${transferToVA}

Tasks:
1. ✅ Collect phone from ${vaName}
2. ✅ Wipe/reset device
3. ✅ Give phone to ${transferToVA}
4. ✅ Update Apple Code if necessary
5. ✅ Verify proxy configuration
6. ✅ Test all apps are working

Please confirm when done!`;
            } else if (phoneAction === 'inventory') {
                return `PHONE RETURN TO INVENTORY

${vaName} is being offboarded.

Tasks:
1. ✅ Collect phone from ${vaName}
2. ✅ Wipe/reset device completely
3. ✅ Store in inventory
4. ✅ Update inventory records

Please confirm when done!`;
            }
            return '';
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('Message copied to clipboard!', 'success');
            }).catch(err => {
                showToast('Failed to copy message', 'error');
                console.error('Copy failed:', err);
            });
        }

        function showToastWithCopy(message, type = 'success', copyText = null) {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;

            if (copyText) {
                toast.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="flex: 1;">${message}</span>
                        <button onclick="copyToClipboard(\`${copyText.replace(/`/g, '\\`')}\`)"
                                style="padding: 6px 12px; background: white; color: black; border-radius: 6px; font-weight: 600; cursor: pointer; border: none; font-size: 12px; white-space: nowrap;">
                            📋 Copy Message
                        </button>
                    </div>
                `;
            } else {
                toast.textContent = message;
            }

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideInRight 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, copyText ? 8000 : 3000); // Longer duration if copy button present
        }

        // Toast notifications
        function showToast(message, type = 'success') {
            showToastWithCopy(message, type, null);
        }

        // API call helper
        async function apiCall(endpoint, options = {}) {
            try {
                const response = await fetch(`${API_URL}${endpoint}`, {
                    ...options,
                    headers: {
                        'Authorization': token ? `Bearer ${token}` : '',
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Request failed');
                }

                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                showToast(error.message, 'error');
                throw error;
            }
        }

        // Login
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            try {
                const data = await apiCall('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({ username, password })
                });

                token = data.token;
                localStorage.setItem('token', token);
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                loadDashboard();
                showToast('Welcome back!');
            } catch (error) {
                document.getElementById('loginError').textContent = 'Invalid credentials';
                document.getElementById('loginError').classList.remove('hidden');
            }
        });

        // Logout
        function logout() {
            localStorage.removeItem('token');
            token = null;
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            showToast('Logged out successfully');
        }

        // Load Dashboard
        async function loadDashboard() {
            try {
                const stats = await apiCall('/dashboard');
                const totalVAsElem = document.getElementById('totalVAs');
                const activeVAsElem = document.getElementById('activeVAs');
                const totalPhonesElem = document.getElementById('totalPhones');
                const totalCreatorsElem = document.getElementById('totalCreators');
                const monthlyPayoutElem = document.getElementById('monthlyPayout');

                if (totalVAsElem) totalVAsElem.textContent = stats.statistics.vas.total_vas || '-';
                if (activeVAsElem) activeVAsElem.textContent = stats.statistics.vas.active_vas || '-';
                if (totalPhonesElem) totalPhonesElem.textContent = stats.statistics.phones.total_phones || '-';
                if (totalCreatorsElem) totalCreatorsElem.textContent = stats.statistics.creators.total_creators || '-';
                if (monthlyPayoutElem) monthlyPayoutElem.textContent = '$' + (stats.statistics.payments.total_amount || '0');

                // Load Creator-Centric view
                await loadCreatorAssignments();

                // Show dashboard tab by default
                showTab('dashboard');
            } catch (error) {
                console.error('Dashboard load error:', error);
            }
        }

        // Load Creator-Centric Assignments View
        async function loadCreatorAssignments() {
            try {
                console.log('Loading creator assignments...');
                const creators = await apiCall('/creators');
                const vas = await apiCall('/vas');

                // Creator-assignments endpoint is optional (requires migration)
                let assignments = [];
                try {
                    assignments = await apiCall('/creator-assignments');
                } catch (error) {
                    console.warn('Creator assignments not available yet (migration pending):', error.message);
                }

                console.log('Data loaded:', { creators: creators.length, vas: vas.length, assignments: assignments.length });

                const creatorContainer = document.getElementById('creatorAssignments');
                const availableVAsContainer = document.getElementById('availableVAs');

                if (!creatorContainer || !availableVAsContainer) {
                    console.error('Container elements not found!');
                    return;
                }

                if (creators.length === 0) {
                    creatorContainer.innerHTML = '<div class="glass rounded-2xl p-8 text-center"><p class="text-gray-400">No creators found. Add your first creator to get started.</p></div>';
                    return;
                }

                // Build creator cards with assigned VAs
                creatorContainer.innerHTML = creators.map(creator => {
                    const creatorAssignments = assignments.filter(a => a.creator_id === creator.id);
                    const assignedVAs = vas.filter(va =>
                        creatorAssignments.some(a => a.va_id === va.id) &&
                        va.status === 'active'
                    );
                    const totalMonthlyCost = assignedVAs.reduce((sum, va) => {
                        const paymentStage = va.va_type === 'social_media' ? getPaymentStage(va.onboarding_date) : null;
                        const salary = paymentStage?.actualSalary || va.custom_salary || va.monthly_base_salary || 0;
                        return sum + (parseFloat(salary) || 0);
                    }, 0);

                    return `
                        <div class="stat-card-modern glass-card">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center" style="gap: var(--space-4);">
                                    ${creator.profile_photo_url ? `
                                        <img src="${creator.profile_photo_url}" alt="${creator.creator_name}"
                                             class="w-14 h-14 rounded-xl object-cover border-2 border-white/20">
                                    ` : `
                                        <div class="w-14 h-14 rounded-xl bg-white/10 border border-white/20 flex items-center justify-center">
                                            <span class="text-white text-xl font-bold">${creator.creator_name.charAt(0).toUpperCase()}</span>
                                        </div>
                                    `}
                                    <div>
                                        <h3 class="font-bold text-xl text-white">${creator.creator_name}</h3>
                                        <p class="text-sm text-gray-400">Active VAs: ${assignedVAs.length}</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-sm text-gray-400">Monthly Cost</p>
                                    <p class="text-xl font-bold text-white">$${totalMonthlyCost.toFixed(2)}</p>
                                </div>
                            </div>

                            ${assignedVAs.length > 0 ? `
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mb-4">
                                    ${assignedVAs.map(va => {
                                        const paymentStage = va.va_type === 'social_media' ? getPaymentStage(va.onboarding_date) : null;
                                        const salary = parseFloat(paymentStage?.actualSalary || va.custom_salary || va.monthly_base_salary || 0);
                                        const vaTypeInfo = {
                                            'social_media': 'SM VA',
                                            'editor': 'Editor',
                                            'manager': 'Manager',
                                            'specialist': 'Specialist'
                                        };
                                        const typeLabel = vaTypeInfo[va.va_type] || 'SM VA';

                                        return `
                                            <div class="bg-gray-800/50 rounded-lg p-3 border border-white/10 hover:border-white/20 transition-all">
                                                <div class="flex items-center gap-2 mb-2">
                                                    <img src="${va.profile_photo_url || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(va.full_name)}"
                                                         class="w-8 h-8 rounded-full object-cover border border-white/20">
                                                    <div class="flex-1 min-w-0">
                                                        <p class="font-semibold text-white text-sm truncate">${va.full_name}</p>
                                                        <p class="text-xs text-gray-400">${typeLabel}</p>
                                                    </div>
                                                </div>
                                                <div class="flex items-center justify-between text-xs">
                                                    <span class="text-gray-400">Salary:</span>
                                                    <span class="font-semibold text-white">$${salary.toFixed(2)}/mo</span>
                                                </div>
                                                ${paymentStage && va.va_type === 'social_media' ? `
                                                    <div class="flex items-center justify-between text-xs mt-1">
                                                        <span class="text-gray-400">Stage:</span>
                                                        <span class="text-white">Month ${paymentStage.currentStage}/3</span>
                                                    </div>
                                                ` : ''}
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            ` : `
                                <div class="bg-yellow-900/20 border border-yellow-600/30 rounded-lg p-4 text-center">
                                    <p class="text-yellow-200 font-semibold">No VAs assigned to this creator</p>
                                </div>
                            `}

                            <div class="flex gap-2 pt-3 border-t border-white/10">
                                <button onclick="editCreator(${creator.id})"
                                        class="flex-1 px-4 py-2 bg-white text-black rounded-lg font-semibold hover:bg-white/90 transition-all text-sm">
                                    Edit Creator
                                </button>
                                <button onclick="showAssignVAModal(${creator.id}, '${creator.creator_name}')"
                                        class="px-4 py-2 bg-white/10 text-white border border-white/20 rounded-lg font-semibold hover:bg-white/20 transition-all text-sm">
                                    + Assign VA
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');

                // Show unassigned VAs
                const assignedVAIds = new Set(assignments.map(a => a.va_id));
                const unassignedVAs = vas.filter(va => !assignedVAIds.has(va.id) && va.status === 'active');

                if (unassignedVAs.length > 0) {
                    availableVAsContainer.innerHTML = unassignedVAs.map(va => {
                        const paymentStage = va.va_type === 'social_media' ? getPaymentStage(va.onboarding_date) : null;
                        const salary = parseFloat(paymentStage?.actualSalary || va.custom_salary || va.monthly_base_salary || 0);

                        return `
                            <div class="glass rounded-xl p-4 hover-lift">
                                <div class="flex items-center gap-3 mb-3">
                                    <img src="${va.profile_photo_url || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(va.full_name)}"
                                         class="w-12 h-12 rounded-full object-cover border-2 border-white/20">
                                    <div class="flex-1 min-w-0">
                                        <p class="font-semibold text-white text-sm truncate">${va.full_name}</p>
                                        <p class="text-xs text-gray-400">${va.telegram_handle}</p>
                                    </div>
                                </div>
                                <div class="space-y-1 text-xs mb-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Salary:</span>
                                        <span class="font-semibold text-white">$${salary.toFixed(2)}/mo</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Status:</span>
                                        <span class="badge badge-${va.status}">${va.status}</span>
                                    </div>
                                </div>
                                <button onclick="showQuickAssignModal(${va.id}, '${va.full_name}')"
                                        class="w-full px-3 py-1.5 bg-white text-black rounded-lg font-semibold hover:bg-white/90 transition-all text-xs">
                                    Assign to Creator
                                </button>
                            </div>
                        `;
                    }).join('');
                } else {
                    availableVAsContainer.innerHTML = '<div class="col-span-full glass rounded-xl p-6 text-center"><p class="text-gray-400">All active VAs are currently assigned</p></div>';
                }

            } catch (error) {
                console.error('Load creator assignments error:', error);
                const creatorContainer = document.getElementById('creatorAssignments');
                if (creatorContainer) {
                    creatorContainer.innerHTML = '<div class="glass rounded-2xl p-8 text-center"><p class="text-red-400">Error loading creator assignments. Check console for details.</p></div>';
                }
            }
        }

        // Show modal to assign VA to a specific creator
        function showAssignVAModal(creatorId, creatorName) {
            // TODO: Implement assign VA modal
            alert(`Assign VA to ${creatorName} - Feature coming soon!`);
        }

        // Show modal to quickly assign an unassigned VA to any creator
        function showQuickAssignModal(vaId, vaName) {
            // TODO: Implement quick assign modal
            alert(`Assign ${vaName} to a creator - Feature coming soon!`);
        }

        // Tab switching
        function showTab(tab) {
            const tabs = ['dashboard', 'vas', 'payments', 'finances', 'phones', 'creators', 'archived'];

            // Hide all tabs
            tabs.forEach(t => {
                const tabElement = document.getElementById(`${t}Tab`);
                if (tabElement) tabElement.classList.add('hidden');

                // Remove active state from sidebar nav items
                const navItem = document.getElementById(`nav${t.charAt(0).toUpperCase() + t.slice(1)}`);
                if (navItem) navItem.classList.remove('active');
            });

            // Show active tab
            const activeTab = document.getElementById(`${tab}Tab`);
            if (activeTab) activeTab.classList.remove('hidden');

            // Add active state to sidebar nav item
            const activeNav = document.getElementById(`nav${tab.charAt(0).toUpperCase() + tab.slice(1)}`);
            if (activeNav) activeNav.classList.add('active');

            // Load data for the tab
            if (tab === 'vas') loadVAs();
            if (tab === 'payments') loadPaymentGroups();
            if (tab === 'finances') loadPaymentHistory();
            if (tab === 'phones') loadPhones();
            if (tab === 'creators') loadCreators();
            if (tab === 'archived') loadArchivedVAs();
        }

        // Load VAs
        async function loadVAs() {
            try {
                const vas = await apiCall('/vas');
                const allCreators = await apiCall('/creators');
                const allAssignments = await apiCall('/creator-assignments');
                const container = document.getElementById('vasList');

                if (vas.length === 0) {
                    container.innerHTML = '<div class="col-span-full text-center text-gray-500 py-12">No VAs found. Add your first VA to get started!</div>';
                    return;
                }

                container.innerHTML = vas.map(va => {
                    // Find all creators this VA manages using junction table
                    const vaAssignments = allAssignments.filter(a => a.va_id === va.id);
                    const managedCreators = allCreators.filter(c =>
                        vaAssignments.some(a => a.creator_id === c.id)
                    );

                    // Calculate payment stage for social media VAs
                    const paymentStage = va.va_type === 'social_media' ? getPaymentStage(va.onboarding_date) : null;

                    // Define VA type display names
                    const vaTypeInfo = {
                        'social_media': { label: 'Social Media VA' },
                        'editor': { label: 'Editor' },
                        'manager': { label: 'Manager' },
                        'specialist': { label: 'Specialist' }
                    };
                    const typeInfo = vaTypeInfo[va.va_type] || vaTypeInfo['social_media'];

                    return `
                        <div class="glass rounded-2xl p-6 hover-lift">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center space-x-3">
                                    <img src="${va.profile_photo_url || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(va.full_name)}"
                                         class="w-16 h-16 rounded-full object-cover border-2 border-purple-200">
                                    <div>
                                        <h3 class="font-bold text-lg text-white">${va.full_name}</h3>
                                        <p class="text-sm text-gray-500">${va.telegram_handle}</p>
                                        ${va.va_type !== 'social_media' ? `
                                            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-900/30 text-purple-200 border border-purple-600/30 mt-1">
                                                ${typeInfo.label}
                                            </span>
                                        ` : ''}
                                    </div>
                                </div>
                                <span class="badge badge-${va.status}">${va.status}</span>
                            </div>

                            ${managedCreators.length > 0 ? `
                                <div class="bg-gray-800/30 border-l-2 border-white/20 px-4 py-3 rounded mb-4">
                                    <p class="text-xs font-semibold text-gray-400 mb-2">MANAGING CREATORS:</p>
                                    <div class="flex flex-wrap gap-2">
                                        ${managedCreators.map(creator => `
                                            <div class="flex items-center space-x-2 bg-gray-800/50 rounded-lg px-3 py-1.5 border border-white/10">
                                                ${creator.profile_photo_url ? `
                                                    <img src="${creator.profile_photo_url}" class="w-6 h-6 rounded object-cover">
                                                ` : `
                                                    <div class="w-6 h-6 rounded bg-white/10 flex items-center justify-center border border-white/20">
                                                        <span class="text-white text-xs font-bold">${creator.creator_name.charAt(0).toUpperCase()}</span>
                                                    </div>
                                                `}
                                                <span class="text-sm font-medium text-white">${creator.creator_name}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : `
                                <div class="bg-gray-100 border-l-4 border-gray-400 px-4 py-2 rounded mb-4">
                                    <p class="text-sm font-semibold text-gray-600">No creators assigned</p>
                                </div>
                            `}

                            <div class="space-y-2 text-sm mb-4">
                                ${va.va_type === 'social_media' ? `
                                    ${va.onboarding_date && paymentStage ? `
                                        <div class="flex justify-between">
                                            <span class="text-gray-400">Joined:</span>
                                            <span class="font-semibold text-white">${new Date(va.onboarding_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-gray-400">Month ${paymentStage.currentStage}/3:</span>
                                            <span class="font-semibold text-white">$${paymentStage.isProRated ? paymentStage.actualSalary.toFixed(2) : paymentStage.currentSalary}</span>
                                        </div>
                                        ${paymentStage.isProRated ? `
                                            <div class="bg-yellow-900/20 border border-yellow-600/30 rounded-lg px-3 py-1.5">
                                                <span class="text-yellow-200 text-xs">Pro-rated for partial month</span>
                                            </div>
                                        ` : ''}
                                        ${!paymentStage.isMaxLevel ? `
                                            <div class="bg-gray-800/30 border border-white/10 rounded-lg px-3 py-2">
                                                <div class="flex justify-between items-center mb-1">
                                                    <span class="text-gray-400 text-xs">Next raise (Month ${paymentStage.nextStage}):</span>
                                                    <span class="text-white text-xs font-semibold">$${paymentStage.nextSalary}</span>
                                                </div>
                                                <div class="w-full bg-gray-700 rounded-full h-1.5">
                                                    <div class="bg-white h-1.5 rounded-full" style="width: ${(paymentStage.currentStage / 3) * 100}%"></div>
                                                </div>
                                            </div>
                                        ` : `
                                            <div class="bg-gray-800/30 border border-white/10 rounded-lg px-3 py-2 text-center">
                                                <span class="text-white text-xs font-semibold">Max Salary Reached ($300)</span>
                                            </div>
                                        `}
                                    ` : `
                                        <div class="flex justify-between">
                                            <span class="text-gray-400">Base Salary:</span>
                                            <span class="font-semibold text-white">$${va.monthly_base_salary}</span>
                                        </div>
                                    `}
                                ` : `
                                    ${va.onboarding_date ? `
                                        <div class="flex justify-between">
                                            <span class="text-gray-400">Joined:</span>
                                            <span class="font-semibold text-white">${new Date(va.onboarding_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</span>
                                        </div>
                                    ` : ''}
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Fixed Salary:</span>
                                        <span class="font-semibold text-white">$${va.custom_salary || va.monthly_base_salary}/month</span>
                                    </div>
                                    <div class="bg-purple-900/20 border border-purple-600/30 rounded-lg px-3 py-1.5 text-center">
                                        <span class="text-purple-200 text-xs">${typeInfo.label} - Fixed Rate</span>
                                    </div>
                                `}
                                ${va.group_name ? `
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Group:</span>
                                        <span class="font-semibold text-white">${va.group_name}</span>
                                    </div>
                                ` : ''}
                                ${managedCreators.length > 0 ? `
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Creators:</span>
                                        <span class="font-semibold text-white">${managedCreators.length}</span>
                                    </div>
                                ` : ''}
                            </div>

                            <div class="flex space-x-2">
                                <button data-action="edit-va" data-va-id="${va.id}"
                                        class="flex-1 px-4 py-2 bg-white text-black rounded-lg font-semibold hover:bg-white/90 transition-all">
                                    Edit
                                </button>
                                <button data-action="offboard-va" data-va-id="${va.id}" data-va-name="${va.full_name}"
                                        class="px-4 py-2 bg-orange-500/20 text-orange-300 border border-orange-500/30 rounded-lg font-semibold hover:bg-orange-500/30 transition-all">
                                    Offboard
                                </button>
                                <button data-action="delete-va" data-va-id="${va.id}" data-va-name="${va.full_name}"
                                        class="px-4 py-2 bg-red-500/20 text-red-300 border border-red-500/30 rounded-lg font-semibold hover:bg-red-500/30 transition-all">
                                    Delete
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Load VAs error:', error);
            }
        }

        // Load Archived VAs
        async function loadArchivedVAs() {
            try {
                const archivedVAs = await apiCall('/vas/archived/list');
                const container = document.getElementById('archivedVAsList');

                if (archivedVAs.length === 0) {
                    container.innerHTML = '<div class="text-center text-gray-400 py-12">No archived VAs found.</div>';
                    return;
                }

                container.innerHTML = archivedVAs.map(va => `
                    <div class="glass rounded-2xl p-6">
                        <div class="flex items-start justify-between">
                            <div class="flex items-center space-x-4">
                                <img src="${va.profile_photo_url || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(va.full_name)}"
                                     class="w-16 h-16 rounded-full object-cover border-2 border-gray-600 opacity-70">
                                <div>
                                    <h3 class="font-bold text-lg text-white">${va.full_name}</h3>
                                    <p class="text-sm text-gray-400">${va.telegram_handle}</p>
                                    <div class="flex items-center space-x-2 mt-2">
                                        <span class="text-xs px-2 py-1 rounded bg-gray-700/50 text-gray-300">
                                            ${va.reason ? va.reason.replace('_', ' ').toUpperCase() : 'N/A'}
                                        </span>
                                        ${va.offboarding_date ? `
                                            <span class="text-xs text-gray-500">
                                                ${new Date(va.offboarding_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
                                            </span>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                            <button onclick="restoreVA(${va.id}, '${va.full_name}')"
                                    class="px-4 py-2 bg-green-500/20 text-green-300 border border-green-500/30 rounded-lg font-semibold hover:bg-green-500/30 transition-all">
                                Restore
                            </button>
                        </div>
                        ${va.final_payment ? `
                            <div class="mt-4 text-sm text-gray-400">
                                <span>Final Payment: </span>
                                <span class="font-semibold text-white">$${va.final_payment}</span>
                            </div>
                        ` : ''}
                        ${va.phone_transferred_to_name ? `
                            <div class="mt-2 text-sm text-gray-400">
                                <span>Phone transferred to: </span>
                                <span class="font-semibold text-white">${va.phone_transferred_to_name}</span>
                            </div>
                        ` : ''}
                    </div>
                `).join('');
            } catch (error) {
                console.error('Load archived VAs error:', error);
            }
        }

        // Load Payment Groups
        async function loadPaymentGroups() {
            try {
                const groups = await apiCall('/payments/groups');
                const container = document.getElementById('paymentGroupsList');

                if (groups.length === 0) {
                    container.innerHTML = '<div class="text-center text-gray-500 py-12">No payment groups found.</div>';
                    return;
                }

                container.innerHTML = groups.map(group => `
                    <div class="glass rounded-2xl p-6 hover-lift">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="font-bold text-xl text-white">${group.group_name}</h3>
                                <p class="text-gray-600 mt-1">Leader: ${group.leader_name}</p>
                                <p class="text-sm text-gray-500 mt-1 font-mono">${group.wallet_address}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-3xl font-bold text-purple-600">$0</p>
                                <p class="text-sm text-gray-500 mt-1">${group.vas_count} VAs</p>
                            </div>
                        </div>

                        <div class="flex space-x-2 mt-4">
                            <button onclick="viewGroupDetails(${group.id})"
                                    class="flex-1 px-4 py-2 bg-purple-100 text-purple-700 rounded-lg font-semibold hover:bg-purple-200">
                                View Details
                            </button>
                            <button onclick="deletePaymentGroup(${group.id}, '${group.group_name}')"
                                    class="px-4 py-2 bg-red-100 text-red-700 rounded-lg font-semibold hover:bg-red-200">
                                Delete
                            </button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Load payment groups error:', error);
            }
        }

        // Load Phones
        async function loadPhones() {
            try {
                const phones = await apiCall('/phones');
                const container = document.getElementById('phonesList');

                if (phones.length === 0) {
                    container.innerHTML = '<div class="col-span-full text-center text-gray-500 py-12">No phones found.</div>';
                    return;
                }

                container.innerHTML = phones.map(phone => `
                    <div class="glass rounded-2xl p-6 hover-lift">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="font-bold text-lg text-white">Phone #${phone.id}</h3>
                                <span class="badge badge-${phone.status === 'available' ? 'active' : 'inactive'} mt-1">
                                    ${phone.status.replace('_', ' ')}
                                </span>
                            </div>
                        </div>

                        <div class="space-y-2 text-sm">
                            <div>
                                <span class="text-gray-500">Apple ID:</span>
                                <p class="font-semibold">${phone.apple_id_email}</p>
                            </div>
                            <div>
                                <span class="text-gray-500">Proxy:</span>
                                <p class="font-semibold font-mono">${phone.proxy_ip}:${phone.proxy_port}</p>
                            </div>
                            ${phone.va_name ? `
                                <div>
                                    <span class="text-gray-500">Assigned to:</span>
                                    <p class="font-semibold">${phone.va_name}</p>
                                </div>
                            ` : ''}
                        </div>

                        <div class="flex space-x-2 mt-4">
                            <button onclick="editPhone(${phone.id})"
                                    class="flex-1 px-4 py-2 bg-blue-100 text-blue-700 rounded-lg font-semibold hover:bg-blue-200">
                                Edit
                            </button>
                            <button onclick="deletePhone(${phone.id})"
                                    class="px-4 py-2 bg-red-100 text-red-700 rounded-lg font-semibold hover:bg-red-200">
                                Delete
                            </button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Load phones error:', error);
            }
        }

        // Load Creators
        async function loadCreators() {
            try {
                const creators = await apiCall('/creators');
                const container = document.getElementById('creatorsList');

                if (creators.length === 0) {
                    container.innerHTML = '<div class="col-span-full text-center text-gray-500 py-12">No creators found.</div>';
                    return;
                }

                container.innerHTML = creators.map(creator => `
                    <div class="glass rounded-2xl p-6 hover-lift">
                        <div class="flex items-center space-x-4 mb-4">
                            ${creator.profile_photo_url ? `
                                <img src="${creator.profile_photo_url}"
                                     alt="${creator.creator_name}"
                                     class="w-16 h-16 rounded-xl object-cover border-2 border-white/20">
                            ` : `
                                <div class="w-16 h-16 rounded-xl bg-white/10 border border-white/20 flex items-center justify-center">
                                    <span class="text-white text-2xl font-bold">${creator.creator_name.charAt(0).toUpperCase()}</span>
                                </div>
                            `}
                            <div class="flex-1">
                                <h3 class="font-bold text-lg text-white">${creator.creator_name}</h3>
                                ${creator.va_name ? `
                                    <p class="text-sm text-gray-400 mt-1">${creator.va_name}</p>
                                ` : `
                                    <span class="badge badge-pending mt-1">Unassigned</span>
                                `}
                            </div>
                        </div>

                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-500">Monthly Cost:</span>
                                <span class="font-semibold">$${creator.monthly_cost || 0}</span>
                            </div>
                        </div>

                        <div class="flex space-x-2 mt-4">
                            <button onclick="editCreator(${creator.id})"
                                    class="flex-1 px-4 py-2 bg-blue-100 text-blue-700 rounded-lg font-semibold hover:bg-blue-200">
                                Edit
                            </button>
                            <button onclick="deleteCreator(${creator.id}, '${creator.creator_name}')"
                                    class="px-4 py-2 bg-red-100 text-red-700 rounded-lg font-semibold hover:bg-red-200">
                                Delete
                            </button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Load creators error:', error);
            }
        }

        // Modal functions
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        async function showAddVAModal() {
            // Set today's date as default for onboarding date
            document.getElementById('vaOnboardingDate').value = new Date().toISOString().split('T')[0];

            // Load payment groups for dropdown
            const groups = await apiCall('/payments/groups');
            const select = document.getElementById('vaPaymentGroup');
            select.innerHTML = '<option value="">No Group</option>' +
                groups.map(g => `<option value="${g.id}">${g.group_name}</option>`).join('');

            // Load creators for checkboxes
            const creators = await apiCall('/creators');
            const checkboxContainer = document.getElementById('creatorCheckboxes');
            if (creators.length === 0) {
                checkboxContainer.innerHTML = '<p class="text-gray-400 text-sm text-center py-4">No creators available. Create creators first.</p>';
            } else {
                checkboxContainer.innerHTML = creators.map(creator => `
                    <label class="flex items-center space-x-3 p-2 rounded-lg hover:bg-white/5 cursor-pointer">
                        <input type="checkbox" name="creator_ids[]" value="${creator.id}"
                               class="w-4 h-4 rounded border-white/20 bg-gray-800/50 text-white focus:ring-white/40">
                        <span class="text-white text-sm">${creator.creator_name}</span>
                    </label>
                `).join('');
            }

            // Load active VAs for phone transfer dropdown
            await loadActiveVAsForTransfer();

            // Initialize Cloudinary widget
            if (!cloudinaryWidget) {
                cloudinaryWidget = cloudinary.createUploadWidget({
                    cloudName: 'dorheqojc',
                    uploadPreset: 'va_photos',
                    sources: ['local', 'camera'],
                    multiple: false,
                    maxFileSize: 10000000,
                    clientAllowedFormats: ['png', 'jpg', 'jpeg']
                }, (error, result) => {
                    if (!error && result && result.event === "success") {
                        document.getElementById('profilePhotoUrl').value = result.info.secure_url;
                        document.getElementById('photoPreview').classList.remove('hidden');
                        document.getElementById('photoPreviewImg').src = result.info.secure_url;
                        showToast('Photo uploaded successfully!');
                    }
                });
            }

            document.getElementById('uploadWidget').onclick = () => cloudinaryWidget.open();
            document.getElementById('addVAModal').classList.remove('hidden');
        }

        function showAddPaymentGroupModal() {
            document.getElementById('addPaymentGroupModal').classList.remove('hidden');
        }

        function showAddPhoneModal() {
            document.getElementById('addPhoneModal').classList.remove('hidden');
        }

        async function showAddCreatorModal() {
            // Initialize Cloudinary widget
            if (!addCreatorCloudinaryWidget) {
                addCreatorCloudinaryWidget = cloudinary.createUploadWidget({
                    cloudName: 'dorheqojc',
                    uploadPreset: 'va_photos',
                    sources: ['local', 'camera'],
                    multiple: false,
                    maxFileSize: 10000000,
                    clientAllowedFormats: ['png', 'jpg', 'jpeg']
                }, (error, result) => {
                    if (!error && result && result.event === "success") {
                        document.getElementById('addCreatorProfilePhotoUrl').value = result.info.secure_url;
                        document.getElementById('addCreatorPhotoPreview').classList.remove('hidden');
                        document.getElementById('addCreatorPhotoPreviewImg').src = result.info.secure_url;
                        showToast('Photo uploaded successfully!');
                    }
                });
            }

            document.getElementById('addCreatorUploadWidget').onclick = () => addCreatorCloudinaryWidget.open();
            document.getElementById('addCreatorModal').classList.remove('hidden');
        }

        // Form submissions
        document.getElementById('addVAForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);

            // Get selected creator IDs
            const creatorCheckboxes = document.querySelectorAll('input[name="creator_ids[]"]:checked');
            const creatorIds = Array.from(creatorCheckboxes).map(cb => parseInt(cb.value));

            try {
                // Create VA with FormData (for file upload support)
                const response = await fetch(`${API_URL}/vas`, {
                    method: 'POST',
                    headers: {
                        'Authorization': token ? `Bearer ${token}` : ''
                        // Don't set Content-Type - browser will set it with boundary for multipart/form-data
                    },
                    body: formData
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Failed to create VA');
                }

                const newVA = await response.json();

                // Assign creators if any selected
                if (creatorIds.length > 0) {
                    await Promise.all(creatorIds.map(creatorId =>
                        apiCall('/creator-assignments', {
                            method: 'POST',
                            body: JSON.stringify({
                                va_id: newVA.id,
                                creator_id: creatorId
                            })
                        })
                    ));
                }

                // Extract values from formData for onboarding and messages
                const phoneType = formData.get('phone_type');
                const phoneFromVAId = formData.get('phone_from_va_id');
                const fullName = formData.get('full_name');

                // Save onboarding checklist (optional - don't block VA creation if this fails)
                try {
                    await apiCall(`/vas/${newVA.id}/complete-onboarding`, {
                        method: 'POST',
                        body: JSON.stringify({
                            apple_code_provided: formData.get('apple_code_provided') === 'on',
                            proxy_configured: formData.get('proxy_configured') === 'on',
                            phone_type: phoneType,
                            phone_from_va_id: phoneFromVAId || null,
                            training_materials_provided: formData.get('training_materials_provided') === 'on'
                        })
                    });
                } catch (onboardingError) {
                    console.warn('Onboarding checklist save failed (non-critical):', onboardingError);
                    // Continue anyway - VA was created successfully
                }

                closeModal('addVAModal');
                e.target.reset();
                document.getElementById('photoPreview').classList.add('hidden');
                await loadVAs();
                await loadDashboard();

                // Generate phone setup message if applicable
                let setupMessage = null;
                let transferFromVAName = null;

                if (phoneType === 'transfer' && phoneFromVAId) {
                    // Get the VA name we're transferring from
                    const allVAs = await apiCall('/vas');
                    const transferFromVA = allVAs.find(va => va.id === parseInt(phoneFromVAId));
                    transferFromVAName = transferFromVA ? transferFromVA.full_name : 'Previous VA';
                    setupMessage = generatePhoneSetupMessage(fullName, 'transfer', transferFromVAName);
                } else if (phoneType === 'new') {
                    setupMessage = generatePhoneSetupMessage(fullName, 'new');
                }

                if (setupMessage) {
                    showToastWithCopy(`VA added successfully! Phone setup needed.`, 'success', setupMessage);
                } else {
                    showToast(`VA added successfully${creatorIds.length > 0 ? ' with ' + creatorIds.length + ' creator(s)' : ''}!`);
                }
            } catch (error) {
                console.error('Add VA error:', error);
                // Error toast already shown by apiCall, just log it
            }
        });

        document.getElementById('addPaymentGroupForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            try {
                await apiCall('/payments/groups', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });

                closeModal('addPaymentGroupModal');
                e.target.reset();
                await loadPaymentGroups();
                showToast('Payment group added successfully!');
            } catch (error) {
                console.error('Add payment group error:', error);
            }
        });

        document.getElementById('addPhoneForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            try {
                await apiCall('/phones', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });

                closeModal('addPhoneModal');
                e.target.reset();
                await loadPhones();
                await loadDashboard();
                showToast('Phone added successfully!');
            } catch (error) {
                console.error('Add phone error:', error);
            }
        });

        document.getElementById('addCreatorForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            try {
                await apiCall('/creators', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });

                closeModal('addCreatorModal');
                e.target.reset();
                document.getElementById('addCreatorPhotoPreview').classList.add('hidden');
                await loadCreators();
                await loadDashboard();
                showToast('Creator added successfully!');
            } catch (error) {
                console.error('Add creator error:', error);
            }
        });

        document.getElementById('editVAForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('editVAId').value;
            const vaType = document.getElementById('editVAType').value;

            const data = {
                full_name: document.getElementById('editFullName').value,
                telegram_handle: document.getElementById('editTelegramHandle').value,
                va_type: vaType,
                custom_salary: vaType !== 'social_media' ? parseFloat(document.getElementById('editCustomSalary').value) : null,
                onboarding_date: document.getElementById('editOnboardingDate').value || null,
                monthly_base_salary: parseFloat(document.getElementById('editMonthlySalary').value) || 500,
                payment_group_id: document.getElementById('editPaymentGroup').value || null,
                status: document.getElementById('editStatus').value,
                profile_photo_url: document.getElementById('editProfilePhotoUrl').value || null
            };

            try {
                // Update VA details
                await apiCall(`/vas/${id}`, {
                    method: 'PUT',
                    body: JSON.stringify(data)
                });

                // Update creator assignments using bulk endpoint (many-to-many)
                const selectedCreatorIds = Array.from(document.getElementById('editAssignedCreators').selectedOptions)
                    .map(opt => parseInt(opt.value));

                await apiCall(`/creator-assignments/va/${id}/bulk`, {
                    method: 'PUT',
                    body: JSON.stringify({ creator_ids: selectedCreatorIds })
                });

                closeModal('editVAModal');
                await loadVAs();
                await loadCreators();
                await loadDashboard();
                showToast('VA and creator assignments updated successfully!');
            } catch (error) {
                console.error('Edit VA error:', error);
                showToast('Failed to update VA', 'error');
            }
        });

        document.getElementById('recordPaymentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            try {
                await apiCall('/payments/history', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });

                closeModal('recordPaymentModal');
                e.target.reset();
                await loadPaymentHistory();
                showToast('Payment recorded successfully!');
            } catch (error) {
                console.error('Record payment error:', error);
            }
        });

        document.getElementById('editPhoneForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('editPhoneId').value;

            const data = {
                apple_id_email: document.getElementById('editPhoneAppleId').value,
                apple_id_password: document.getElementById('editPhonePassword').value,
                proxy_ip: document.getElementById('editPhoneProxyIp').value,
                proxy_port: parseInt(document.getElementById('editPhoneProxyPort').value),
                proxy_username: document.getElementById('editPhoneProxyUsername').value || null,
                proxy_password: document.getElementById('editPhoneProxyPassword').value || null,
                assigned_to_va_id: document.getElementById('editPhoneVASelect').value || null,
                status: document.getElementById('editPhoneStatus').value
            };

            try {
                await apiCall(`/phones/${id}`, {
                    method: 'PUT',
                    body: JSON.stringify(data)
                });

                closeModal('editPhoneModal');
                await loadPhones();
                await loadDashboard();
                showToast('Phone updated successfully!');
            } catch (error) {
                console.error('Edit phone error:', error);
                showToast('Failed to update phone', 'error');
            }
        });

        document.getElementById('editCreatorForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('editCreatorId').value;

            const data = {
                creator_name: document.getElementById('editCreatorName').value,
                monthly_cost: parseFloat(document.getElementById('editCreatorMonthlyCost').value) || 0,
                notes: document.getElementById('editCreatorNotes').value || null,
                profile_photo_url: document.getElementById('editCreatorPhotoUrl').value || null
            };

            try {
                await apiCall(`/creators/${id}`, {
                    method: 'PUT',
                    body: JSON.stringify(data)
                });

                closeModal('editCreatorModal');
                await loadCreators();
                await loadDashboard();
                showToast('Creator updated successfully!');
            } catch (error) {
                console.error('Edit creator error:', error);
                showToast('Failed to update creator', 'error');
            }
        });

        document.getElementById('offboardVAForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const vaId = document.getElementById('offboardVAId').value;
            const vaName = document.getElementById('offboardVAName').value;

            if (!confirm(`Are you sure you want to offboard ${vaName}? This will archive the VA.`)) return;

            const formData = new FormData(e.target);
            const phoneAction = document.getElementById('offboardPhoneAction').value;

            const data = {
                reason: formData.get('reason'),
                reason_details: formData.get('reason_details') || null,
                final_payment: parseFloat(formData.get('final_payment')) || 0,
                phone_transferred_to_va_id: phoneAction === 'transfer' ? parseInt(formData.get('phone_transferred_to_va_id')) : null,
                phone_returned_to_inventory: phoneAction === 'inventory',
                notes: formData.get('notes') || null,
                offboarded_by: 'Admin' // TODO: Get from logged-in user
            };

            try {
                await apiCall(`/vas/${vaId}/offboard`, {
                    method: 'POST',
                    body: JSON.stringify(data)
                });

                closeModal('offboardVAModal');
                e.target.reset();
                await loadVAs();
                await loadDashboard();

                // Generate phone management message if applicable
                let phoneMessage = null;
                let transferToVAName = null;

                if (phoneAction === 'transfer' && data.phone_transferred_to_va_id) {
                    // Get the VA name we're transferring to
                    const allVAs = await apiCall('/vas');
                    const transferToVA = allVAs.find(va => va.id === data.phone_transferred_to_va_id);
                    transferToVAName = transferToVA ? transferToVA.full_name : 'New VA';
                    phoneMessage = generateOffboardingMessage(vaName, 'transfer', transferToVAName);
                } else if (phoneAction === 'inventory') {
                    phoneMessage = generateOffboardingMessage(vaName, 'inventory');
                }

                if (phoneMessage) {
                    showToastWithCopy(`${vaName} offboarded successfully! Phone action needed.`, 'success', phoneMessage);
                } else {
                    showToast(`${vaName} offboarded successfully!`);
                }
            } catch (error) {
                console.error('Offboard VA error:', error);
                showToast('Failed to offboard VA', 'error');
            }
        });

        // Delete functions
        async function deleteVA(id, name) {
            if (!confirm(`Are you sure you want to delete ${name}?`)) return;

            try {
                await apiCall(`/vas/${id}`, { method: 'DELETE' });
                await loadVAs();
                await loadDashboard();
                showToast('VA deleted successfully!');
            } catch (error) {
                console.error('Delete VA error:', error);
            }
        }

        async function restoreVA(id, name) {
            if (!confirm(`Are you sure you want to restore ${name} to active status?`)) return;

            try {
                await apiCall(`/vas/${id}/restore`, { method: 'POST' });
                await loadArchivedVAs();
                await loadVAs();
                await loadDashboard();
                showToast(`${name} restored successfully!`);
            } catch (error) {
                console.error('Restore VA error:', error);
                showToast('Failed to restore VA', 'error');
            }
        }

        async function deletePaymentGroup(id, name) {
            if (!confirm(`Are you sure you want to delete ${name}?`)) return;

            try {
                await apiCall(`/payments/groups/${id}`, { method: 'DELETE' });
                await loadPaymentGroups();
                showToast('Payment group deleted successfully!');
            } catch (error) {
                console.error('Delete payment group error:', error);
            }
        }

        async function deletePhone(id) {
            if (!confirm('Are you sure you want to delete this phone?')) return;

            try {
                await apiCall(`/phones/${id}`, { method: 'DELETE' });
                await loadPhones();
                await loadDashboard();
                showToast('Phone deleted successfully!');
            } catch (error) {
                console.error('Delete phone error:', error);
            }
        }

        async function deleteCreator(id, name) {
            if (!confirm(`Are you sure you want to delete ${name}?`)) return;

            try {
                await apiCall(`/creators/${id}`, { method: 'DELETE' });
                await loadCreators();
                await loadDashboard();
                showToast('Creator deleted successfully!');
            } catch (error) {
                console.error('Delete creator error:', error);
            }
        }

        async function deletePaymentRecord(id) {
            if (!confirm('Are you sure you want to delete this payment record?')) return;

            try {
                await apiCall(`/payments/history/${id}`, { method: 'DELETE' });
                await loadPaymentHistory();
                showToast('Payment record deleted successfully!');
            } catch (error) {
                console.error('Delete payment record error:', error);
            }
        }

        // Load Payment History
        async function loadPaymentHistory() {
            try {
                const history = await apiCall('/payments/history');
                const tbody = document.getElementById('paymentHistoryTable');

                if (history.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" class="px-6 py-8 text-center text-gray-500">No payment history found.</td></tr>';
                    return;
                }

                tbody.innerHTML = history.map(payment => {
                    const date = new Date(payment.payment_date).toLocaleDateString();
                    const statusClass = payment.status === 'completed' ? 'badge-active' :
                                       payment.status === 'pending' ? 'badge-pending' : 'badge-inactive';

                    return `
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 text-sm text-gray-900">${date}</td>
                            <td class="px-6 py-4 text-sm font-semibold text-gray-900">${payment.va_name}</td>
                            <td class="px-6 py-4 text-sm font-semibold text-green-600">$${parseFloat(payment.amount).toFixed(2)}</td>
                            <td class="px-6 py-4 text-sm text-gray-900 capitalize">${payment.payment_type}</td>
                            <td class="px-6 py-4"><span class="badge ${statusClass}">${payment.status}</span></td>
                            <td class="px-6 py-4 text-sm text-gray-600">${payment.notes || '-'}</td>
                            <td class="px-6 py-4 text-sm">
                                <button onclick="deletePaymentRecord(${payment.id})"
                                        class="text-red-600 hover:text-red-800 font-semibold">Delete</button>
                            </td>
                        </tr>
                    `;
                }).join('');
            } catch (error) {
                console.error('Load payment history error:', error);
            }
        }

        // Show Record Payment Modal
        async function showRecordPaymentModal() {
            const vas = await apiCall('/vas');
            const select = document.getElementById('paymentVASelect');
            select.innerHTML = '<option value="">Select VA</option>' +
                vas.filter(v => v.status === 'active').map(v => `<option value="${v.id}">${v.full_name}</option>`).join('');

            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            document.querySelector('#recordPaymentForm input[name="payment_date"]').value = today;

            document.getElementById('recordPaymentModal').classList.remove('hidden');
        }

        // Edit functions
        async function editVA(id) {
            try {
                // Load VA data
                const va = await apiCall(`/vas/${id}`);

                // Load payment groups for dropdown
                const groups = await apiCall('/payments/groups');
                const select = document.getElementById('editPaymentGroup');
                select.innerHTML = '<option value="">No Group</option>' +
                    groups.map(g => `<option value="${g.id}" ${g.id === va.payment_group_id ? 'selected' : ''}>${g.group_name}</option>`).join('');

                // Load all creators and currently assigned creators from junction table
                const allCreators = await apiCall('/creators');
                const assignedCreators = await apiCall(`/creator-assignments/va/${id}`);
                const assignedCreatorIds = assignedCreators.map(c => c.id);

                const creatorsSelect = document.getElementById('editAssignedCreators');
                creatorsSelect.innerHTML = allCreators.map(c =>
                    `<option value="${c.id}" ${assignedCreatorIds.includes(c.id) ? 'selected' : ''}>${c.creator_name}</option>`
                ).join('');

                // Initialize edit Cloudinary widget
                if (!editCloudinaryWidget) {
                    editCloudinaryWidget = cloudinary.createUploadWidget({
                        cloudName: 'dorheqojc',
                        uploadPreset: 'va_photos',
                        sources: ['local', 'camera'],
                        multiple: false,
                        maxFileSize: 10000000,
                        clientAllowedFormats: ['png', 'jpg', 'jpeg']
                    }, (error, result) => {
                        if (!error && result && result.event === "success") {
                            document.getElementById('editProfilePhotoUrl').value = result.info.secure_url;
                            document.getElementById('editPhotoPreview').classList.remove('hidden');
                            document.getElementById('editPhotoPreviewImg').src = result.info.secure_url;
                            showToast('Photo uploaded successfully!');
                        }
                    });
                }

                // Populate form with VA data
                document.getElementById('editVAId').value = va.id;
                document.getElementById('editFullName').value = va.full_name || '';
                document.getElementById('editTelegramHandle').value = va.telegram_handle || '';

                // Set VA Type and toggle custom salary field
                document.getElementById('editVAType').value = va.va_type || 'social_media';
                document.getElementById('editCustomSalary').value = va.custom_salary || '';
                toggleEditCustomSalary(); // Show/hide appropriate salary field

                // Format date for HTML5 date input (YYYY-MM-DD)
                if (va.onboarding_date) {
                    const date = new Date(va.onboarding_date);
                    document.getElementById('editOnboardingDate').value = date.toISOString().split('T')[0];
                } else {
                    document.getElementById('editOnboardingDate').value = '';
                }
                document.getElementById('editMonthlySalary').value = va.monthly_base_salary || 500;
                document.getElementById('editStatus').value = va.status || 'active';
                document.getElementById('editProfilePhotoUrl').value = va.profile_photo_url || '';

                // Show existing photo if available
                if (va.profile_photo_url) {
                    document.getElementById('editPhotoPreview').classList.remove('hidden');
                    document.getElementById('editPhotoPreviewImg').src = va.profile_photo_url;
                } else {
                    document.getElementById('editPhotoPreview').classList.add('hidden');
                }

                // Setup edit upload widget click
                document.getElementById('editUploadWidget').onclick = () => editCloudinaryWidget.open();

                // Show modal
                document.getElementById('editVAModal').classList.remove('hidden');
            } catch (error) {
                console.error('Edit VA error:', error);
                showToast('Failed to load VA data', 'error');
            }
        }

        let editCreatorCloudinaryWidget;

        async function editPhone(id) {
            try {
                const phone = await apiCall(`/phones/${id}`);
                const vas = await apiCall('/vas');

                const vaSelect = document.getElementById('editPhoneVASelect');
                vaSelect.innerHTML = '<option value="">Unassigned</option>' +
                    vas.filter(v => v.status === 'active').map(v =>
                        `<option value="${v.id}" ${v.id === phone.assigned_to_va_id ? 'selected' : ''}>${v.full_name}</option>`
                    ).join('');

                document.getElementById('editPhoneId').value = phone.id;
                document.getElementById('editPhoneAppleId').value = phone.apple_id_email || '';
                document.getElementById('editPhonePassword').value = phone.apple_id_password || '';
                document.getElementById('editPhoneProxyIp').value = phone.proxy_ip || '';
                document.getElementById('editPhoneProxyPort').value = phone.proxy_port || '';
                document.getElementById('editPhoneProxyUsername').value = phone.proxy_username || '';
                document.getElementById('editPhoneProxyPassword').value = phone.proxy_password || '';
                document.getElementById('editPhoneStatus').value = phone.status || 'available';

                document.getElementById('editPhoneModal').classList.remove('hidden');
            } catch (error) {
                console.error('Edit phone error:', error);
                showToast('Failed to load phone data', 'error');
            }
        }

        async function editCreator(id) {
            try {
                const creator = await apiCall(`/creators/${id}`);

                // Initialize Cloudinary widget for creator edit
                if (!editCreatorCloudinaryWidget) {
                    editCreatorCloudinaryWidget = cloudinary.createUploadWidget({
                        cloudName: 'dorheqojc',
                        uploadPreset: 'va_photos',
                        sources: ['local', 'camera'],
                        multiple: false,
                        maxFileSize: 10000000,
                        clientAllowedFormats: ['png', 'jpg', 'jpeg']
                    }, (error, result) => {
                        if (!error && result && result.event === "success") {
                            document.getElementById('editCreatorPhotoUrl').value = result.info.secure_url;
                            document.getElementById('editCreatorPhotoPreview').classList.remove('hidden');
                            document.getElementById('editCreatorPhotoPreviewImg').src = result.info.secure_url;
                            showToast('Photo uploaded successfully!');
                        }
                    });
                }

                document.getElementById('editCreatorId').value = creator.id;
                document.getElementById('editCreatorName').value = creator.creator_name || '';
                document.getElementById('editCreatorMonthlyCost').value = creator.monthly_cost || 0;
                document.getElementById('editCreatorNotes').value = creator.notes || '';
                document.getElementById('editCreatorPhotoUrl').value = creator.profile_photo_url || '';

                if (creator.profile_photo_url) {
                    document.getElementById('editCreatorPhotoPreview').classList.remove('hidden');
                    document.getElementById('editCreatorPhotoPreviewImg').src = creator.profile_photo_url;
                } else {
                    document.getElementById('editCreatorPhotoPreview').classList.add('hidden');
                }

                document.getElementById('editCreatorUploadWidget').onclick = () => editCreatorCloudinaryWidget.open();
                document.getElementById('editCreatorModal').classList.remove('hidden');
            } catch (error) {
                console.error('Edit creator error:', error);
                showToast('Failed to load creator data', 'error');
            }
        }

        async function viewGroupDetails(groupId) {
            try {
                // Fetch group details
                const group = await apiCall(`/payments/groups/${groupId}`);

                // Fetch all VAs in this group
                const allVAs = await apiCall('/vas');
                const groupVAs = allVAs.filter(va => va.payment_group_id === groupId);

                // Calculate total payout
                const totalPayout = groupVAs.reduce((sum, va) => sum + (parseFloat(va.monthly_base_salary) || 0), 0);

                // Build the details HTML
                const content = `
                    <div class="bg-gray-800/50 border border-white/20 rounded-2xl p-6 text-white mb-6">
                        <h4 class="text-3xl font-bold mb-2">${group.group_name}</h4>
                        <p class="text-gray-400 mb-4">Leader: ${group.leader_name}</p>
                        <div class="bg-white/10 rounded-xl p-4 border border-white/10">
                            <p class="text-sm text-gray-400 mb-1">Group Wallet Address</p>
                            <p class="font-mono text-sm break-all">${group.group_wallet_address}</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <div class="bg-gray-800/30 border border-white/10 rounded-xl p-4">
                            <p class="text-sm text-gray-400 mb-1">Total VAs</p>
                            <p class="text-2xl font-bold text-white">${groupVAs.length}</p>
                        </div>
                        <div class="bg-gray-800/30 border border-white/10 rounded-xl p-4">
                            <p class="text-sm text-gray-400 mb-1">Monthly Payout</p>
                            <p class="text-2xl font-bold text-white">$${totalPayout.toFixed(2)}</p>
                        </div>
                        <div class="bg-gray-800/30 border border-white/10 rounded-xl p-4">
                            <p class="text-sm text-gray-400 mb-1">Status</p>
                            <p class="text-2xl font-bold text-white">${groupVAs.filter(va => va.status === 'active').length} Active</p>
                        </div>
                    </div>

                    <div class="bg-gray-800/30 rounded-xl border border-white/10 overflow-hidden">
                        <div class="bg-gray-800/50 px-6 py-4 border-b border-white/10">
                            <h5 class="font-bold text-white">Virtual Assistants in this Group</h5>
                        </div>
                        <div class="divide-y divide-white/10">
                            ${groupVAs.length === 0 ? `
                                <div class="px-6 py-8 text-center text-gray-400">
                                    No VAs assigned to this group yet
                                </div>
                            ` : groupVAs.map(va => `
                                <div class="px-6 py-4 hover:bg-white/5 flex items-center justify-between transition-colors">
                                    <div class="flex items-center space-x-4">
                                        ${va.profile_photo_url ? `
                                            <img src="${va.profile_photo_url}" class="w-12 h-12 rounded-full object-cover border-2 border-white/20">
                                        ` : `
                                            <div class="w-12 h-12 rounded-full bg-white/10 border border-white/20 flex items-center justify-center text-white font-bold">
                                                ${va.full_name.charAt(0)}
                                            </div>
                                        `}
                                        <div>
                                            <p class="font-semibold text-white">${va.full_name}</p>
                                            <p class="text-sm text-gray-400">${va.telegram_handle}</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-6">
                                        <div class="text-right">
                                            <p class="text-sm text-gray-400">Monthly Salary</p>
                                            <p class="font-bold text-white">$${parseFloat(va.monthly_base_salary || 0).toFixed(2)}</p>
                                        </div>
                                        <span class="px-3 py-1 rounded-full text-xs font-semibold ${
                                            va.status === 'active' ? 'bg-white/10 text-white border border-white/20' : 'bg-gray-800/50 text-gray-400 border border-white/10'
                                        }">
                                            ${va.status}
                                        </span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;

                document.getElementById('groupDetailsContent').innerHTML = content;
                document.getElementById('groupDetailsModal').classList.remove('hidden');
            } catch (error) {
                console.error('View group details error:', error);
                showToast('Failed to load group details', 'error');
            }
        }

        // Event delegation for VA buttons - MUST be attached immediately on page load
        // This ensures buttons work even if loadDashboard() encounters errors
        document.addEventListener('click', function(e) {
            const button = e.target.closest('[data-action]');
            if (!button) return;

            const action = button.dataset.action;
            const vaId = parseInt(button.dataset.vaId);
            const vaName = button.dataset.vaName;

            console.log('Button clicked:', action, vaId, vaName);

            switch(action) {
                case 'edit-va':
                    editVA(vaId);
                    break;
                case 'offboard-va':
                    showOffboardVAModal(vaId, vaName);
                    break;
                case 'delete-va':
                    deleteVA(vaId, vaName);
                    break;
            }
        });
        console.log('✅ Event delegation listener attached');

        // Auto-login if token exists
        if (token) {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            loadDashboard();
        }
    </script>
</body>
</html>